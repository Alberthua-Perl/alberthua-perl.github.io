<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢ä¸–ç•Œï¼ğŸ’ª | Thumbs Up for Cloud Native ğŸ¤˜">
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          Podman å®¹å™¨åŸç†ä¸ä½¿ç”¨ï¼ˆ2ï¼‰ - Alberthua çš„åšå®¢ | Alberthua&#39;s Blog
        
    </title>

    <link rel="canonical" href="https://alberthua-perl.github.io/2022/12/05/podman-usage-practice/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Alberthua Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="https://alberthua-perl.github.io/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('podman-bg.webp')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#äº‘åŸç”Ÿ" title="äº‘åŸç”Ÿ">äº‘åŸç”Ÿ</a>
                        
                          <a class="tag" href="/tags/#å®¹å™¨" title="å®¹å™¨">å®¹å™¨</a>
                        
                    </div>
                    <h1>Podman å®¹å™¨åŸç†ä¸ä½¿ç”¨ï¼ˆ2ï¼‰</h1>
                    <h2 class="subheading">Podman Architecture and Usage (2)</h2>
                    <span class="meta">
                        Posted by Alberthua on
                        2022-12-05
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h3 id="æ–‡æ¡£è¯´æ˜ï¼š"><a href="#æ–‡æ¡£è¯´æ˜ï¼š" class="headerlink" title="æ–‡æ¡£è¯´æ˜ï¼š"></a>æ–‡æ¡£è¯´æ˜ï¼š</h3><ul>
<li><a href="https://github.com/Alberthua-Perl/tech-docs/blob/master/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/Podman%20%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BD%BF%E7%94%A8%EF%BC%881%EF%BC%89.md" target="_blank" rel="noopener">ä¸Šä¸€ç¯‡</a> å·²è¯´æ˜ Podman åŸç†ä¸å®ç°ï¼Œè¯¥æ–‡æ¡£å°†ç»§ç»­è¯´æ˜ Podman å®¹å™¨çš„ä½¿ç”¨ä¸å®è·µã€‚</li>
</ul>
<h3 id="æ–‡æ¡£ç›®å½•ï¼š"><a href="#æ–‡æ¡£ç›®å½•ï¼š" class="headerlink" title="æ–‡æ¡£ç›®å½•ï¼š"></a>æ–‡æ¡£ç›®å½•ï¼š</h3><ul>
<li>podman å•å®¹å™¨ä½¿ç”¨åŠé€šä¿¡æ–¹å¼ç¤ºä¾‹</li>
<li>ä½¿ç”¨ podman-compose å®ç° Gogs è½»é‡çº§ä»£ç ä»“åº“</li>
<li>podman pod å¤šå®¹å™¨ç¼–æ’ä½¿ç”¨ç¤ºä¾‹</li>
<li>ä½¿ç”¨ podman kube play å®ç° WordPress çš„ä¸€é”®éƒ¨ç½²</li>
<li>Podman ä½¿ç”¨æŠ¥é”™ç¤ºä¾‹</li>
<li>Podman æœ‰å¾…æµ‹è¯•åŠŸèƒ½</li>
</ul>
<h3 id="podman-å•å®¹å™¨ä½¿ç”¨åŠé€šä¿¡æ–¹å¼ç¤ºä¾‹ï¼š"><a href="#podman-å•å®¹å™¨ä½¿ç”¨åŠé€šä¿¡æ–¹å¼ç¤ºä¾‹ï¼š" class="headerlink" title="podman å•å®¹å™¨ä½¿ç”¨åŠé€šä¿¡æ–¹å¼ç¤ºä¾‹ï¼š"></a>podman å•å®¹å™¨ä½¿ç”¨åŠé€šä¿¡æ–¹å¼ç¤ºä¾‹ï¼š</h3><ul>
<li>ç¤ºä¾‹ 1ï¼š<br>ğŸ‘‰ ä½¿ç”¨ podman å‘½ä»¤ç™»å½• <code>Quay</code> å…¬å…±å®¹å™¨é•œåƒä»“åº“å¹¶æ¨é€é•œåƒï¼š<img src="podman-push-quay.jpg" alt="podman-push-quay.jpg">ğŸ‘‰ æœç´¢å¹¶æ‹‰å– Red Hat å®¹å™¨é•œåƒä»“åº“ä¸­çš„é•œåƒåˆ—è¡¨ï¼š<img src="podman-pull-image.jpg" alt="podman-pull-image.jpg"></li>
<li>ç¤ºä¾‹ 2ï¼š<br>ğŸ¤˜ éƒ¨ç½²å¹¶ä½¿ç”¨äº‘åŸç”Ÿè½»é‡çº§å¯¹è±¡å­˜å‚¨ <code>MinIO Server</code>ï¼š<br><img src="minio-server-cloud-native-object-storage-demo-1.jpg" alt="minio-server-cloud-native-object-storage-demo-1.jpg"><img src="minio-server-cloud-native-object-storage-demo-2.jpg" alt="minio-server-cloud-native-object-storage-demo-2.jpg">ä»¥ä¸Šç¤ºä¾‹å°† podman ä¸ systemd é›†æˆå®ç°æ™®é€šç”¨æˆ·çš„ rootless å®¹å™¨å¼€æœºè‡ªå¯åŠ¨ã€‚<img src="minio-server-cloud-native-object-storage-demo-3.jpg" alt="minio-server-cloud-native-object-storage-demo-3.jpg">å…³äº MinIO Server åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨çš„è¯¦ç»†å†…å®¹ï¼Œè¯· <a href="https://min.io/" target="_blank" rel="noopener">å‚è€ƒå®˜ç½‘</a>ã€‚</li>
<li>ç¤ºä¾‹ 3ï¼š<br>ğŸ¤˜ è¯·å‚è€ƒè¯¥æ–‡æ¡£ <a href="https://github.com/Alberthua-Perl/scripts-confs/tree/master/deploy-rsyslog-viewer" target="_blank" rel="noopener">éƒ¨ç½² loganalyzer ç®¡ç†é›†ä¸­å¼æ—¥å¿—</a> ä»¥ç†è§£å¤šä¸ª rootfull å®¹å™¨é—´çš„é€šä¿¡æ–¹å¼ï¼ˆé€šè¿‡ <code>cni-podman0</code> ç½‘æ¡¥ä¸ <code>iptables</code> äº’ç›¸é€šä¿¡ï¼‰ã€‚</li>
</ul>
<h3 id="ä½¿ç”¨-podman-compose-å®ç°-Gogs-è½»é‡çº§ä»£ç ä»“åº“ï¼š"><a href="#ä½¿ç”¨-podman-compose-å®ç°-Gogs-è½»é‡çº§ä»£ç ä»“åº“ï¼š" class="headerlink" title="ä½¿ç”¨ podman-compose å®ç° Gogs è½»é‡çº§ä»£ç ä»“åº“ï¼š"></a>ä½¿ç”¨ podman-compose å®ç° Gogs è½»é‡çº§ä»£ç ä»“åº“ï¼š</h3><ul>
<li>ä½¿ç”¨ <code>podman-compose</code> é€šè¿‡ <code>link</code> é“¾æ¥è‡³æŒ‡å®šçš„å®¹å™¨å»ºç«‹é€šä¿¡ã€‚</li>
<li><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œéƒ¨ç½² Gogs è½»é‡çº§ä»£ç ä»“åº“ï¼š<code>Gogs + PostgreSQL</code>  </p>
<ul>
<li>å…³äº podman-compose çš„å®‰è£…å¯å‚è€ƒ <a href="https://github.com/containers/podman-compose" target="_blank" rel="noopener">GitHub é¡¹ç›®</a></li>
</ul>
<blockquote>
<p>ğŸ¤” å¯è€ƒè™‘ä½¿ç”¨ podman-compose éƒ¨ç½²è½»é‡çº§ <code>Gitea + Drone</code> CI æŒç»­é›†æˆå¹³å°</p>
</blockquote>
<ul>
<li>å…³äº Gogs é¡¹ç›®çš„è¯¦ç»†å†…å®¹å¯å‚è€ƒ <a href="https://github.com/gogs/gogs" target="_blank" rel="noopener">Gogs GitHub é¡¹ç›®</a>  </li>
<li>Gogs ä»£ç ç‰ˆæœ¬æ§åˆ¶ä»“åº“ä½¿ç”¨ Golang è¯­è¨€å¼€å‘ï¼Œå¯ä¸åç«¯ MySQLã€PostgreSQLã€SQLite3ã€TiDB ç­‰é›†æˆã€‚  </li>
<li>æ­¤å¤„ä½¿ç”¨å®¹å™¨åŒ–éƒ¨ç½² Gogsï¼Œå¹¶ä¸ PostgreSQL é›†æˆã€‚  </li>
<li><p>éƒ¨ç½²ç”¨ä¸»æœºä¸Šå¿…é¡»å…ˆå®‰è£… podman ä¸ podman-composeï¼Œå¹¶æ‹‰å–ç›¸åº”å®¹å™¨é•œåƒåŠ é€Ÿéƒ¨ç½²è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<img src="podman-image-list.jps.JPG" alt="podman-image-list.jps.JPG"></p>
<blockquote>
<p>ğŸ“Œ<strong>æ³¨æ„ï¼š</strong></p>
<p>podman-compose ä½¿ç”¨åˆ›å»º <code>pod</code> å°†å¤šä¸ªå®¹å™¨ç»„å»ºæˆ pod çš„æ–¹å¼è¿›è¡Œå®¹å™¨ç¼–æ’ï¼Œå› æ­¤å¿…é¡»å…·æœ‰ <code>pause</code> å®¹å™¨é•œåƒæä¾› pod çš„å…±äº«ç½‘ç»œå‘½åç©ºé—´ä¸æŒ‚è½½å‘½åç©ºé—´ã€‚</p>
</blockquote>
</li>
<li><p>ä½¿ç”¨æ™®é€šç”¨æˆ·éƒ¨ç½²ï¼Œè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p gogs-app/gogs-data/&#123;gogs,gogs-logs,postgresql&#125;</span><br><span class="line"><span class="comment"># åˆ›å»ºç”¨äºå­˜å‚¨ gogs ä¸ postgresql æ•°æ®æ˜ å°„çš„ç›®å½•</span></span><br><span class="line">$ sudo chown -R 100999:100999 gogs-app/gogs-data/&#123;gogs,gogs-logs&#125;</span><br><span class="line"><span class="comment"># æ›´æ”¹æ˜ å°„ç›®å½•çš„å±ç»„ï¼Œå¦åˆ™å®¹å™¨å¯åŠ¨æƒé™æŠ¥é”™ã€‚</span></span><br><span class="line">$ getenforce</span><br><span class="line">  Enforcing</span><br><span class="line"><span class="comment"># ç¡®è®¤ç³»ç»Ÿå¤„äº enforcing SELinux çŠ¶æ€ï¼Œéœ€è®¾ç½®ç›®å½•æ˜ å°„æ—¶çš„æ ‡ç­¾ã€‚</span></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ç¦ç”¨ SELinuxï¼Œè‹¥ç¦ç”¨ SELinuxï¼Œä»¥ä¸‹ä¸¤æ­¥å¯ä¸æ‰§è¡Œå¹¶ä¸”å»é™¤ podman-compose å®šä¹‰æ–‡ä»¶ä¸­çš„ "Z"ã€‚</span></span><br><span class="line">$ sudo semanage port -a -t http_port_t -p tcp 10800</span><br><span class="line">$ sudo semanage port -a -t ssh_port_t -p tcp 10022</span><br><span class="line"><span class="comment"># æ·»åŠ è‡ªå®šä¹‰ç«¯å£è‡³ SELinux æ•°æ®åº“ä¸­ï¼Œå¦åˆ™ç”±äºæƒé™é—®é¢˜æ— æ³•è®¿é—®å¹¶å®‰è£… Gogsã€‚</span></span><br><span class="line">$ vim gogs-app/gogs-postgres-podman-compose.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚ä¸‹æ‰€ç¤º <code>gogs-postgres-podman-compose.yaml</code> æ–‡ä»¶å¯å‚è€ƒ <a href="https://github.com/Alberthua-Perl/dockerfile-s2i-demo/blob/master/gogs-postgres-compose/gogs-postgres-podman-compose.yaml" target="_blank" rel="noopener">æ­¤å¤„</a>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">postgresql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.io/library/postgres:14.1-bullseye</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">"gogs-postgresql"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"./gogs-data/postgresql:/var/lib/postgresql:Z"</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"POSTGRES_USER=gogs"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"POSTGRES_PASSWORD=redhat"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"POSTGRES_DB=gogs"</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"5432:5432"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">gogs:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.io/gogs/gogs:0.12</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">"gogs"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"./gogs-data/gogs:/data:Z"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"./gogs-data/gogs-logs:/app/gogs/log:Z"</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"10022:22"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"10800:3000"</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">postgresql</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¾‘å®Œæˆ yaml æ–‡ä»¶åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨åº”ç”¨ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ podman-compose -f gogs-app/gogs-postgres-podman-compose.yaml --project gogs-app up</span><br><span class="line"><span class="comment"># å¯åŠ¨ Gogs ä¸ PostgreSQL å®¹å™¨ï¼Œå¹¶æŒ‡å®šé¡¹ç›®åç§°ã€‚</span></span><br><span class="line"><span class="comment"># è‹¥ä¸æŒ‡å®šé¡¹ç›®åç§°ï¼Œé¡¹ç›®é»˜è®¤ä¸º yaml æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åç§°ã€‚</span></span><br><span class="line"><span class="comment"># é¦–æ¬¡å¯åŠ¨å®¹å™¨æ—¶ï¼Œæ‰€æœ‰çš„å¯åŠ¨ä¸è¿è¡Œæ—¥å¿—å°†æ‰“å°è‡³ç»ˆç«¯å±å¹•ä¸Šï¼Œè¯¥ç»ˆç«¯ä¸å¯å…³é—­ï¼Œç›´è‡³å…³é—­æ‰€æœ‰æœåŠ¡å®¹å™¨åå°†è‡ªåŠ¨é€€å‡ºã€‚</span></span><br><span class="line">$ podman-compose -f gogs-app/gogs-postgres-podman-compose.yaml --project gogs-app ps</span><br><span class="line">  using podman version: podman version 3.2.3</span><br><span class="line">  podman ps -a --filter label=io.podman.compose.project=gogs-app</span><br><span class="line">  CONTAINER ID  IMAGE                                     COMMAND               CREATED      STATUS          PORTS                                                                   NAMES</span><br><span class="line">  2bed211ffe60  docker.io/library/postgres:14.1-bullseye  postgres              6 hours ago  Up 3 hours ago  0.0.0.0:10022-&gt;22/tcp, 0.0.0.0:10800-&gt;3000/tcp, 0.0.0.0:5432-&gt;5432/tcp  gogs-postgresql</span><br><span class="line">  2c7d0de4b0a0  docker.io/gogs/gogs:0.12                  /bin/s6-svscan /a...  6 hours ago  Up 3 hours ago  0.0.0.0:10022-&gt;22/tcp, 0.0.0.0:10800-&gt;3000/tcp, 0.0.0.0:5432-&gt;5432/tcp  gogs</span><br><span class="line">  0</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ podman-compose ç®¡ç†çš„å®¹å™¨æœåŠ¡</span></span><br><span class="line">$ podman ps</span><br><span class="line">  CONTAINER ID  IMAGE                                     COMMAND               CREATED      STATUS          PORTS                                                                   NAMES</span><br><span class="line">  b6df150a3a49  k8s.gcr.io/pause:3.5                                            6 hours ago  Up 6 hours ago  0.0.0.0:10022-&gt;22/tcp, 0.0.0.0:10800-&gt;3000/tcp, 0.0.0.0:5432-&gt;5432/tcp  c3a10da46f18-infra</span><br><span class="line">  2bed211ffe60  docker.io/library/postgres:14.1-bullseye  postgres              6 hours ago  Up 3 hours ago  0.0.0.0:10022-&gt;22/tcp, 0.0.0.0:10800-&gt;3000/tcp, 0.0.0.0:5432-&gt;5432/tcp  gogs-postgresql</span><br><span class="line">  2c7d0de4b0a0  docker.io/gogs/gogs:0.12                  /bin/s6-svscan /a...  6 hours ago  Up 3 hours ago  0.0.0.0:10022-&gt;22/tcp, 0.0.0.0:10800-&gt;3000/tcp, 0.0.0.0:5432-&gt;5432/tcp  gogs</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼ŒåŒ…å« infra å®¹å™¨ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰€æœ‰å®¹å™¨æ­£å¸¸è¿è¡Œåï¼Œä½¿ç”¨ <code>http://&lt;å®¹å™¨å®¿ä¸»æœº IP åœ°å€&gt;:10800</code> è®¿é—® Gogs å®‰è£…ç•Œé¢ï¼Œéœ€å¡«å…¥çš„å€¼å‚è€ƒå¦‚ä¸‹ï¼š<img src="gogs-settings.jpg" alt="gogs-settings.jpg">    </p>
<ul>
<li>Run User å€¼ï¼šé»˜è®¤ <code>git</code>ã€‚</li>
<li>Domain å€¼ï¼šè‹¥è¦ä»å…¶ä»–ä¸»æœºè¿æ¥è‡³ Gogs ä»“åº“ï¼ŒDomian å¿…é¡»é…ç½®ä¸ºå®¹å™¨å®¿ä¸»æœºçš„ IP åœ°å€æˆ–ä¸»æœºåã€‚</li>
<li>SSH Port å€¼ï¼špodman-compose å®šä¹‰æ–‡ä»¶ä¸­å¯¹å¤–æš´éœ²çš„ SSH ç«¯å£å·ã€‚</li>
<li>HTTP Port å€¼ï¼šé»˜è®¤ <code>3000</code> ç«¯å£ã€‚  </li>
</ul>
</li>
<li>Web é¡µé¢ä¸­æœ€åéœ€è®¾ç½® Gogs ç®¡ç†å‘˜è´¦å·ä»¥å®Œæˆå®‰è£…ã€‚  </li>
<li>å®‰è£…å®Œæˆåï¼Œä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•æˆ–é‡æ–°æ³¨å†Œæ–°è´¦å·ç™»å½•ä¸ä½¿ç”¨ã€‚  </li>
<li>å¦‚ä¸‹æ‰€ç¤ºï¼Œä½¿ç”¨ <code>devops</code> ç”¨æˆ·åˆ›å»ºæ–°ä»£ç åº“å¹¶å®Œæˆ commit æäº¤ï¼š<img src="gogs-git-repository.jpg" alt="gogs-git-repository.jpg">  </li>
<li><p>å¦‚éœ€å…³é—­ Gogs ä»£ç ä»“åº“ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åœæ­¢ gogs ä¸ postgresql å®¹å™¨æœåŠ¡å³å¯ï¼š    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ podman-compose -f gogs-app/gogs-postgres-podman-compose.yaml --project gogs-app stop gogs postgresql</span><br><span class="line">  using podman version: podman version 3.2.3</span><br><span class="line">  podman stop -t 10 gogs</span><br><span class="line">  gogs</span><br><span class="line">  0</span><br><span class="line">  podman stop -t 10 gogs-postgresql</span><br><span class="line">  gogs-postgresql</span><br><span class="line">  0</span><br><span class="line">$ podman ps</span><br><span class="line">  CONTAINER ID  IMAGE                 COMMAND     CREATED       STATUS             PORTS                                                                   NAMES</span><br><span class="line">  b6df150a3a49  k8s.gcr.io/pause:3.5              30 hours ago  Up 39 minutes ago  0.0.0.0:10022-&gt;22/tcp, 0.0.0.0:10800-&gt;3000/tcp, 0.0.0.0:5432-&gt;5432/tcp  c3a10da46f18-infra</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ğŸ’¥<strong>æ³¨æ„ï¼š</strong></p>
<p>åˆ‡ä¸å¯ç›´æ¥ä½¿ç”¨ podman-compose å‘½ä»¤çš„ <code>down</code> å­å‘½ä»¤ï¼Œè¯¥å­å‘½ä»¤å°†æ‰€æœ‰ç›¸å…³çš„å®¹å™¨ä¸ pod å…¨éƒ¨åˆ é™¤ï¼Œpod åˆ é™¤åæ— æ³•å°†å…¶ä¸­çš„å„å®¹å™¨æ˜ å°„è‡³å®¿ä¸»æœºå¯¹åº”çš„ç›®å½•ä¸­ï¼Œå³ä½¿åŸå§‹æ•°æ®ä¾ç„¶ä¿ç•™äºç›®å½•ä¸­ã€‚</p>
</blockquote>
</li>
<li><p>é‡æ–°å¯åŠ¨ Gogs ä»£ç ä»“åº“çš„æ–¹å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ podman-compose -f gogs-app/gogs-postgres-podman-compose.yaml --project gogs-app start gogs postgresql</span><br><span class="line">  using podman version: podman version 3.2.3</span><br><span class="line">  podman start gogs</span><br><span class="line">  gogs</span><br><span class="line">  0</span><br><span class="line">  podman start gogs-postgresql</span><br><span class="line">  gogs-postgresql</span><br><span class="line">  0</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="podman-pod-å¤šå®¹å™¨ç¼–æ’ä½¿ç”¨ç¤ºä¾‹ï¼š"><a href="#podman-pod-å¤šå®¹å™¨ç¼–æ’ä½¿ç”¨ç¤ºä¾‹ï¼š" class="headerlink" title="podman pod å¤šå®¹å™¨ç¼–æ’ä½¿ç”¨ç¤ºä¾‹ï¼š"></a>podman pod å¤šå®¹å™¨ç¼–æ’ä½¿ç”¨ç¤ºä¾‹ï¼š</h3><ul>
<li><code>podman-compose</code> çš„ä½¿ç”¨ä¾èµ–äº <code>python</code> ç‰ˆæœ¬ä»¥åŠä¾èµ–åŒ…ï¼Œè‹¥åœ¨ä¸åŒå¹³å°ä¸­ä½¿ç”¨å¯èƒ½å­˜åœ¨æ— æ³•å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ python åŠä¾èµ–åŒ…çš„æƒ…å†µï¼Œå› æ­¤ podman-compose å¹¶ä¸èƒ½å¾ˆå¥½çš„è§£å†³å•æœºä¸Šçš„å¤šå®¹å™¨ç¼–æ’é—®é¢˜ã€‚</li>
<li>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œpodman è‡ªå¸¦çš„ <code>podman pod</code> å­å‘½ä»¤å¯åŸç”Ÿæ”¯æŒå¤šå®¹å™¨ç¼–æ’ï¼Œè¯¥å‘½ä»¤å¯å°†å¤šå®¹å™¨è¿è¡ŒäºåŒä¸€ pod ä¸­ä½¿ç”¨ç›¸åŒçš„ <code>network namespace</code> ä»¥æ›´æ–¹ä¾¿çš„è°ƒé…å®¹å™¨ã€‚</li>
<li><p>å¦‚ä¸‹å‘½ä»¤æ‰€ç¤ºï¼š<br>ğŸ‘‰ ä»å¤´åˆ›å»º pod å¹¶é™„åŠ é¢å¤–çš„å®¹å™¨ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ podman pod create --name &lt;pod_name&gt; [-p &lt;host_port&gt;:&lt;pod_port&gt;]</span><br><span class="line"><span class="comment"># ä½¿ç”¨ pause å®¹å™¨é•œåƒä»å¤´åˆ›å»º pod</span></span><br><span class="line"><span class="comment"># è‹¥ä¹‹åéœ€åœ¨ pod ä¸­åˆ›å»ºä½¿ç”¨ç«¯å£æ˜ å°„çš„å®¹å™¨ï¼Œéœ€è¦åœ¨åˆ›å»º pod ä¹‹åˆæŒ‡å®šç«¯å£æ˜ å°„å…³ç³»ï¼Œæ— æ³•åœ¨åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šï¼Œç”±äº pod</span></span><br><span class="line"><span class="comment"># æä¾›äº†å…¶ä¸­æ‰€æœ‰å®¹å™¨çš„å…±äº«ç½‘ç»œå‘½åç©ºé—´ã€‚</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šè‹¥éœ€æŒ‡å®šå¤šä¸ªç«¯å£ï¼Œå¯åŒæ—¶ä½¿ç”¨å¤šä¸ª -p é€‰é¡¹ã€‚</span></span><br><span class="line">$ podman run -d --name &lt;container_name&gt; --pod &lt;pod_name&gt; &lt;container_image&gt;:&lt;tag&gt;</span><br><span class="line"><span class="comment"># åˆ›å»ºå®¹å™¨å°†å…¶é™„åŠ åˆ° pod ä¸­</span></span><br><span class="line">$ podman pod [ps|list|ls]</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å·²å­˜åœ¨çš„ pod</span></span><br><span class="line">$ podman pod [stop|rm] &lt;pod_name&gt;</span><br><span class="line"><span class="comment"># åœæ­¢æˆ–åˆ é™¤ podï¼Œå°†ä¸€å¹¶åˆ é™¤ pod ä¸­çš„æ‰€æœ‰å®¹å™¨ã€‚</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ğŸ“Œ<strong>æ³¨æ„ï¼š</strong></p>
<ol>
<li><code>k8s.gcr.io/pause:3.5</code> é•œåƒæ‹‰å–éœ€è¦ç§‘å­¦ä¸Šç½‘ã€‚</li>
<li>è‹¥æ— æ³•æ‹‰å–ï¼Œå¯å…ˆæ‹‰å– <code>registry.aliyuncs.com/google_containers/pause:3.5</code> é•œåƒï¼Œå†æ›´æ”¹å…¶ <code>tag</code> å³å¯ã€‚</li>
</ol>
</blockquote>
<p>ğŸ‘‰ éšåˆ›å»ºå®¹å™¨æ—¶åŒæ—¶åˆ›å»º podï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ podman run -d \</span><br><span class="line">  --name &lt;container_name&gt; --pod new:&lt;pod_name&gt; \</span><br><span class="line">  [-p &lt;host_port&gt;:&lt;pod_port&gt;] \</span><br><span class="line">  &lt;container_image&gt;:&lt;tag&gt;</span><br><span class="line"><span class="comment"># éšåˆ›å»ºå®¹å™¨æ—¶åŒæ—¶åˆ›å»º pod</span></span><br><span class="line">$ podman run -d \</span><br><span class="line">  --name &lt;container_name&gt; --pod &lt;pod_name&gt; \</span><br><span class="line">  &lt;container_image&gt;:&lt;tag&gt;</span><br><span class="line"><span class="comment"># åœ¨ pod ä¸­åˆ›å»ºæ–°çš„å®¹å™¨</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¤ºä¾‹ 1ï¼š<br>å¦‚ä¸‹æ‰€ç¤ºï¼Œåˆ›å»ºåä¸º <code>nginx-docs</code> çš„å®¹å™¨å¹¶åŒæ—¶åˆ›å»ºåä¸º <code>docker-docs</code> çš„ podï¼Œä¹Ÿå¯åˆ›å»ºå…¶ä»–å®¹å™¨æ·»åŠ è‡³ pod ä¸­ï¼Œpod ä¸­çš„å®¹å™¨å…±äº« <code>network namespace</code>ï¼š<img src="podman-run-pod-create.jpg" alt="podman-run-pod-create.jpg"></p>
</li>
<li>ğŸ¤˜ ç¤ºä¾‹ 2ï¼š<br>ä½¿ç”¨ podman åœ¨å•ä¸ª pod ä¸­é›†æˆå¤šå®¹å™¨çš„æ–¹æ³•ï¼Œå¯å‚è€ƒ <a href="https://github.com/Alberthua-Perl/tech-docs/blob/master/Red%20Hat%20Quay%20v3%20registry%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0.md" target="_blank" rel="noopener">ä¹‹å‰å‘å¸ƒçš„æ–‡æ¡£</a>ï¼Œè¯¥æ–‡æ¡£ä¸­å°† Quayã€MySQL ä¸ Redis çš„å•å®¹å™¨é›†æˆåœ¨å•ä¸ª pod ä¸­ï¼Œä½¿ç”¨ pod çš„ <code>network namespace</code> æ–¹ä¾¿ Quay é•œåƒä»“åº“çš„ç®¡ç†ã€‚</li>
</ul>
<h3 id="ğŸš€-ä½¿ç”¨-podman-kube-play-å®ç°-WordPress-çš„ä¸€é”®éƒ¨ç½²ï¼š"><a href="#ğŸš€-ä½¿ç”¨-podman-kube-play-å®ç°-WordPress-çš„ä¸€é”®éƒ¨ç½²ï¼š" class="headerlink" title="ğŸš€ ä½¿ç”¨ podman kube play å®ç° WordPress çš„ä¸€é”®éƒ¨ç½²ï¼š"></a>ğŸš€ ä½¿ç”¨ podman kube play å®ç° WordPress çš„ä¸€é”®éƒ¨ç½²ï¼š</h3><ul>
<li>é™¤ä¸Šè¿° podman pod å®¹å™¨ç¼–æ’çš„æ–¹å¼ä»¥å¤–ï¼Œpodman ä¹Ÿå·²æ”¯æŒç±»ä¼¼äºä½¿ç”¨ <code>Kubernetes</code> ç»“æ„åŒ– <code>yaml</code> æ–‡ä»¶çš„æ–¹å¼ï¼Œå³å¯ä½¿ç”¨ <code>podman kube play</code> åˆ›å»º <code>Pod</code>ã€<code>Deployment</code> ä¸ <code>PersistentVolumeClaim</code> ç­‰ã€‚</li>
<li><p>å¯å°†ç”± <code>podman pod create</code> åˆ›å»ºçš„ pod é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ pod çš„èµ„æºå®šä¹‰æ–‡ä»¶ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman generate kube &lt;pod_name&gt; &gt; &lt;application_name&gt;.yml</span><br><span class="line"><span class="comment"># å¯¼å‡ºå·²å­˜åœ¨ pod çš„èµ„æºå®šä¹‰æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¯¥ç¤ºä¾‹ä¸­ç”Ÿæˆçš„ pod èµ„æºå®šä¹‰æ–‡ä»¶éœ€ç¨åŠ æ”¹åŠ¨ç”¨äºåº”ç”¨çš„éƒ¨ç½²ï¼Œå¯å‚è€ƒ <a href="https://github.com/Alberthua-Perl/go-kubernetes-learn-path/blob/hotfixes/mywpblog-pod.yml" target="_blank" rel="noopener">è¯¥é“¾æ¥</a>ï¼š  </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mywpblog</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mywpblog</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">automountServiceAccountToken:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mysqld</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_USER</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">wp_user</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">redhat</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_PASSWORD</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">wp_pass</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_DATABASE</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">wp_blog</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.io/library/mysql:5.7.40-debian</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">wpdatabase</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">hostPort:</span> <span class="number">3306</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="attr">securityContext:</span></span><br><span class="line">      <span class="attr">capabilities:</span></span><br><span class="line">        <span class="attr">drop:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">CAP_MKNOD</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">CAP_NET_RAW</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">CAP_AUDIT_WRITE</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">tmp-wpdbfiles-host-0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">apache2-foreground</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">WORDPRESS_DB_NAME</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">wp_blog</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">WORDPRESS_DB_HOST</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">"0.0.0.0"</span></span><br><span class="line">      <span class="comment"># WORDPRESS_DB_HOST definied as '0.0.0.0' because two containers </span></span><br><span class="line">      <span class="comment"># use same network namespace</span></span><br><span class="line">      <span class="comment"># WORDPRESS_DB_HOST is different from 'podman pod create' and </span></span><br><span class="line">      <span class="comment"># 'podman kube play'.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">WORDPRESS_DB_USER</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">wp_user</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">WORDPRESS_DB_PASSWORD</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">wp_pass</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.io/library/wordpress:6.1.1-php7.4-apache</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">wpfrontend</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">hostPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="attr">securityContext:</span></span><br><span class="line">      <span class="attr">capabilities:</span></span><br><span class="line">        <span class="attr">drop:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">CAP_MKNOD</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">CAP_NET_RAW</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">CAP_AUDIT_WRITE</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/www/html</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">tmp-wpfront-host-0</span></span><br><span class="line">  <span class="attr">enableServiceLinks:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">hostname:</span> <span class="string">mywpblog</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/tmp/wpdbfiles</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Directory</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">tmp-wpdbfiles-host-0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/tmp/wpfront</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Directory</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">tmp-wpfront-host-0</span></span><br><span class="line"><span class="attr">status:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨è¯¥ <a href="https://github.com/Alberthua-Perl/go-kubernetes-learn-path/blob/hotfixes/wpblog-pod-manage" target="_blank" rel="noopener">è„šæœ¬</a> å®ç° WordPress åº”ç”¨çš„ä¸€é”®éƒ¨ç½²ä¸ç®¡ç†ï¼ŒWordPress å®¹å™¨ä¸ MySQL å®¹å™¨è¿è¡ŒäºåŒä¸€ pod ä¸­ï¼Œè¿è¡ŒæˆåŠŸåæ‰“å¼€æµè§ˆå™¨å³å¯è®¿é—®å®‰è£… WordPress åº”ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ./wpblog-pod-manage --kube-deploy</span><br><span class="line">---&gt; Start deploy blog pod...</span><br><span class="line">---&gt; Use podman kube play to create and run pod...</span><br><span class="line">Pod:</span><br><span class="line">7e8d6586ed246380fdb9ee00e73361b16938d4f2d5b646041f5036d9b7e4e8ae</span><br><span class="line">Containers:</span><br><span class="line">5132590944a03adcdfc08ba27945c708ae23b19fdce24fbcda9df6c845b5bc4e</span><br><span class="line">cc2e7cb2a3a5423a7f0d93d07590b5826657eeb59d0491c5578dde0a1d10de1e</span><br><span class="line">---&gt; Pod and containers as followings...</span><br><span class="line">POD ID        NAME        STATUS      CREATED         INFRA ID      <span class="comment"># OF CONTAINERS</span></span><br><span class="line">7e8d6586ed24  mywpblog    Running     34 seconds ago  ca2ea53dfcbb  3</span><br><span class="line"></span><br><span class="line">CONTAINER ID  IMAGE                                            COMMAND               CREATED         STATUS            PORTS                                         NAMES</span><br><span class="line">ca2ea53dfcbb  localhost/podman-pause:4.3.0-1666339791                                35 seconds ago  Up 2 seconds ago  0.0.0.0:3306-&gt;3306/tcp, 0.0.0.0:8080-&gt;80/tcp  7e8d6586ed24-infra    </span><br><span class="line">5132590944a0  docker.io/library/mysql:5.7.40-debian            mysqld                19 seconds ago  Up 2 seconds ago  0.0.0.0:3306-&gt;3306/tcp, 0.0.0.0:8080-&gt;80/tcp  mywpblog-wpdatabase   </span><br><span class="line">cc2e7cb2a3a5  docker.io/library/wordpress:6.1.1-php7.4-apache  apache2-foregroun...  4 seconds ago   Up 2 seconds ago  0.0.0.0:3306-&gt;3306/tcp, 0.0.0.0:8080-&gt;80/tcp  mywpblog-wpfrontend   </span><br><span class="line"><span class="comment"># ä½¿ç”¨ podman kube play çš„æ–¹å¼éƒ¨ç½² WordPress åº”ç”¨</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Podman-æŠ¥é”™ç¤ºä¾‹ï¼š"><a href="#Podman-æŠ¥é”™ç¤ºä¾‹ï¼š" class="headerlink" title="Podman æŠ¥é”™ç¤ºä¾‹ï¼š"></a>Podman æŠ¥é”™ç¤ºä¾‹ï¼š</h3><ul>
<li>podman å®¹å™¨é•œåƒä»“åº“çš„é…ç½®æ–¹å¼ï¼š  <ul>
<li>å…¨å±€é…ç½®ï¼š<code>/etc/containers/registries.conf</code></li>
<li>å±€éƒ¨é…ç½®ï¼š<code>$HOME/.config/containers/registroes.conf</code></li>
</ul>
</li>
<li>è‹¥ podman å®‰è£…ååœ¨ä»¥ä¸Šé…ç½®ä¸­æœªå”¯ä¸€æŒ‡å®šçš„å®¹å™¨é•œåƒä»“åº“ï¼Œé‚£ä¹ˆåœ¨æ‹‰å–å®¹å™¨é•œåƒæ—¶ï¼Œå°†äº¤äº’å¼æç¤ºç”¨æˆ·é€‰æ‹©å®¹å™¨é•œåƒä»“åº“ã€‚</li>
<li><p>Podman ç™»å½•å®¹å™¨é•œåƒä»“åº“çš„æ–¹å¼ï¼š  </p>
<ul>
<li><p>ä½¿ç”¨ <code>podman login</code> å­å‘½ä»¤ç™»å½•æŒ‡å®šçš„å®¹å™¨é•œåƒä»“åº“æ—¶ï¼ŒPodman å°†è®¿é—® token é»˜è®¤å­˜å‚¨äº <code>/run/user/&lt;UID&gt;/containers/auth.json</code> æ–‡ä»¶ä¸­ï¼Œå½“ logout ä»“åº“æ—¶ï¼Œè¯¥ token å°†è¢«ç§»é™¤ï¼Œå¹¶ä¸”è¯¥æ–‡ä»¶ä¸­å¯å­˜å‚¨å¤šä¸ªç™»å½•çš„ä»“åº“ tokenã€‚<img src="podman-login-token.jpg" alt="podman-login-token.jpg">    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">logout</span> --all</span><br><span class="line"><span class="comment"># ç™»å‡ºæ‰€æœ‰çš„å®¹å™¨é•œåƒä»“åº“ï¼Œå¹¶ä» auth.json æ–‡ä»¶ä¸­ç§»é™¤æ‰€æœ‰çš„ tokenã€‚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Podman é»˜è®¤æƒ…å†µä¸‹éœ€è¦ä¸å®¹å™¨é•œåƒä»“åº“ä½¿ç”¨ <code>TLS</code> è®¤è¯ï¼Œè‹¥å®¹å™¨é•œåƒä»“åº“æœªé…ç½® TLSã€ä½¿ç”¨è‡ªç­¾åçš„ TLS è¯ä¹¦æˆ–æœªçŸ¥çš„ CA ç­¾ç½²çš„è¯ä¹¦ï¼Œéœ€å¯¹ loginã€pull æˆ– push å­å‘½ä»¤æ·»åŠ  <code>--tls-verify=false</code> é€‰é¡¹ä»¥å®Œæˆè®¤è¯ã€‚  </p>
</li>
<li>Skopeo ä¸ Buildah ä¹Ÿå¯ä½¿ç”¨ Podman ä¿å­˜çš„è®¤è¯ tokenï¼Œä½†æ˜¯æ— æ³•æ‰§è¡Œäº¤äº’å¼çš„ç™»å½•å¯†ç è¾“å…¥ã€‚</li>
</ul>
</li>
<li><p>ç¤ºä¾‹ 1ï¼š<br>ğŸ‘‰ podman v3.2.3 ç™»å½• Harbor v1.8.1 èº«ä»½è®¤è¯æŠ¥é”™ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ podman login harbor.domain12.example.com:8880</span><br><span class="line">  Username: admin</span><br><span class="line">  Password: redhat</span><br><span class="line">  Error: authenticating creds <span class="keyword">for</span> <span class="string">"harbor.domain12.example.com:8880"</span>: error pinging docker registry </span><br><span class="line">  harbor.domain12.example.com:8880: Get <span class="string">"https://harbor.domain12.example.com:8880/v2/"</span>: </span><br><span class="line">  http: server gave HTTP response to HTTPS client</span><br><span class="line"><span class="comment"># Podman æœªåšä»»ä½•é…ç½®ç™»å½• Harbor æŠ¥é”™ï¼Œè¯¥ Harbor å®¹å™¨é•œåƒä»“åº“æœªé…ç½® TLS åŠ å¯†ä¼ è¾“ã€‚</span></span><br><span class="line"><span class="comment"># æŠ¥é”™æ˜¾ç¤º Harbor å“åº” HTTP è¯·æ±‚ï¼Œè€Œ Podman å‘é€ HTTPS è¯·æ±‚ç™»å½•ã€‚</span></span><br><span class="line"><span class="comment"># å› æ­¤ï¼Œå°† Podman é…ç½®ä¸ºå‘é€ HTTP è¯·æ±‚çš„å®¢æˆ·ç«¯ã€‚</span></span><br></pre></td></tr></table></figure>
<p>ğŸ¤” è§£å†³æ–¹å¼ä¸€ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ podman login --tls-verify=<span class="literal">false</span> harbor.domain12.example.com:8880</span><br><span class="line">  Username: admin</span><br><span class="line">  Password: redhat</span><br><span class="line">  Login Succeeded!</span><br><span class="line"><span class="comment"># Podman æœªè¿›è¡Œä»»ä½•é…ç½®ï¼Œç›´æ¥ä½¿ç”¨ --tls-verify=false é€‰é¡¹å³å¯è®¤è¯ç™»å½•ã€‚</span></span><br></pre></td></tr></table></figure>
<p>ğŸ¤” è§£å†³æ–¹å¼äºŒï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p ~/.config/containers/ &amp;&amp; <span class="built_in">cd</span> ~/.config/containers/</span><br><span class="line"><span class="comment"># åˆ›å»ºæ™®é€šç”¨æˆ· rootless å®¹å™¨çš„ç›®å½•</span></span><br><span class="line">$ vim ~/.config/containers/registries.conf</span><br><span class="line">  unqualified-search-registries = [<span class="string">'harbor.domain12.example.com:8880'</span>]</span><br><span class="line"></span><br><span class="line">  [[registry]]</span><br><span class="line">  location = <span class="string">"harbor.domain12.example.com:8880"</span></span><br><span class="line">  insecure = <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If true, unencrypted HTTP as well as TLS connections with untrusted</span></span><br><span class="line">  <span class="comment"># certificates are allowed.</span></span><br><span class="line">  block = <span class="literal">false</span></span><br><span class="line"><span class="comment"># é…ç½®æœªåŠ å¯†ä¼ è¾“çš„ Harbor å®¹å™¨é•œåƒä»“åº“çš„ä¸»æœºåä¸ç«¯å£</span></span><br><span class="line"></span><br><span class="line">$ podman login --<span class="built_in">log</span>-level=debug harbor.domain12.example.com:8880</span><br><span class="line">  INFO[0000] podman filtering at <span class="built_in">log</span> level debug</span><br><span class="line">  DEBU[0000] Called login.PersistentPreRunE(podman login --<span class="built_in">log</span>-level=debug harbor.domain12.example.com:8880)</span><br><span class="line">  DEBU[0000] overlay storage already configured with a mount-program</span><br><span class="line">  DEBU[0000] Merged system config <span class="string">"/usr/share/containers/containers.conf"</span></span><br><span class="line">  DEBU[0000] overlay storage already configured with a mount-program</span><br><span class="line">  DEBU[0000] Using conmon: <span class="string">"/usr/bin/conmon"</span></span><br><span class="line">  ...</span><br><span class="line">  DEBU[0000] Using OCI runtime <span class="string">"/usr/bin/runc"</span></span><br><span class="line">  DEBU[0000] Default CNI network name podman is unchangeable</span><br><span class="line">  INFO[0000] Setting parallel job count to 13</span><br><span class="line">  DEBU[0000] Loading registries configuration <span class="string">"/home/kiosk/.config/containers/registries.conf"</span></span><br><span class="line">  DEBU[0000] Loading registries configuration <span class="string">"/etc/containers/registries.conf.d/000-shortnames.conf"</span></span><br><span class="line">  DEBU[0000] Loading registries configuration <span class="string">"/etc/containers/registries.conf.d/001-rhel-shortnames.conf"</span></span><br><span class="line">  DEBU[0000] Loading registries configuration <span class="string">"/etc/containers/registries.conf.d/002-rhel-shortnames-overrides.conf"</span></span><br><span class="line">  DEBU[0000] No credentials <span class="keyword">for</span> harbor.domain12.example.com:8880 found</span><br><span class="line">  Username: admin</span><br><span class="line">  Password: <span class="comment"># äº¤äº’å¼è¾“å…¥ç™»å½•å¯†ç </span></span><br><span class="line">  DEBU[0004] Looking <span class="keyword">for</span> TLS certificates and private keys <span class="keyword">in</span> /etc/docker/certs.d/harbor.domain12.example.com:8880</span><br><span class="line">  DEBU[0004] GET https://harbor.domain12.example.com:8880/v2/</span><br><span class="line">  DEBU[0004] Ping https://harbor.domain12.example.com:8880/v2/ err Get <span class="string">"https://harbor.domain12.example.com:8880/v2/"</span>: http: </span><br><span class="line">  server gave HTTP response to HTTPS client (&amp;url.Error&#123;Op:<span class="string">"Get"</span>, URL:<span class="string">"https://harbor.domain12.example.com:8880/v2/"</span>, </span><br><span class="line">  Err:(*errors.errorString)(0xc000590030)&#125;)</span><br><span class="line">  ...</span><br><span class="line">  DEBU[0004] GET http://harbor.domain12.example.com:8880/service/token?account=admin&amp;service=harbor-registry</span><br><span class="line">  DEBU[0004] GET http://harbor.domain12.example.com:8880/v2/</span><br><span class="line">  DEBU[0004] Stored credentials <span class="keyword">for</span> harbor.domain12.example.com:8880 <span class="keyword">in</span> credential helper containers-auth.json</span><br><span class="line">  Login Succeeded!</span><br><span class="line">  DEBU[0004] Called login.PersistentPostRunE(podman login --<span class="built_in">log</span>-level=debug harbor.domain12.example.com:8880)</span><br><span class="line"><span class="comment"># Podman é»˜è®¤ä½¿ç”¨ TLS åŠ å¯†ä¼ è¾“</span></span><br><span class="line"><span class="comment"># ä»¥ä¸Šé…ç½®æ–‡ä»¶å°†ä½¿ Podman ä»¥ HTTP æ–¹å¼è®¤è¯ç™»å½• Harborã€‚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¤ºä¾‹ 2ï¼š<br>ğŸ‘‰ podman v3.2.3 æ¨é€å®¹å™¨é•œåƒè‡³ Harbor v1.8.1 ä¸­æ˜¾ç¤º â€œä¸å®Œæ•´â€ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ podman push harbor.domain12.example.com:8880/library/apache-rhce8.2-alpine:1.0</span><br><span class="line">  Getting image <span class="built_in">source</span> signatures</span><br><span class="line">  Copying blob 551db21ded82 skipped: already exists</span><br><span class="line">  Copying blob 8213d0880f11 skipped: already exists</span><br><span class="line">  Copying blob e2eb06d8af82 skipped: already exists</span><br><span class="line">  ...</span><br><span class="line">  Copying blob 05e56f8d5aae skipped: already exists</span><br><span class="line">  Copying blob 631e8a8040bb skipped: already exists</span><br><span class="line">  Copying blob dedba5c062fc skipped: already exists</span><br><span class="line">  Copying blob 0e609f35aa06 [--------------------------------------] 0.0b / 0.0b</span><br><span class="line">  Copying config 34f32c2e7a [======================================] 10.0KiB / 10.0KiB</span><br><span class="line">  Writing manifest to image destination</span><br><span class="line">  Storing signatures</span><br></pre></td></tr></table></figure>
<p>ä»æ¨é€çš„è¿”å›ç»“æœæ˜¾ç¤ºï¼Œå…·æœ‰ 2 å±‚å®¹å™¨é•œåƒå±‚ä¼¼ä¹æœªæ¨é€æˆåŠŸï¼Œä½†å°†è¯¥é•œåƒä» Harbor ä¸­æ‹‰å–å¹¶é‡æ–°è¿è¡Œå®¹å™¨åï¼Œå®¹å™¨èƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼Œå› æ­¤æœ€å 2 å±‚é•œåƒå±‚å®é™…æ¨é€æˆåŠŸã€‚</p>
</li>
<li>ç¤ºä¾‹ 3ï¼š<br>ğŸ‘‰ å®¹å™¨é•œåƒæ— ä»»ä½•è¿è¡Œæˆ–é€€å‡ºçŠ¶æ€å®¹å™¨å ç”¨ï¼Œä½†ä¾ç„¶æ— æ³•åˆ é™¤é•œåƒï¼Œå¯å°è¯•ä½¿ç”¨ <code>--force</code> é€‰é¡¹å°†å…¶å¼ºåˆ¶åˆ é™¤ã€‚<img src="podman-rmi-error-no-container-use.jpg" alt="podman-rmi-error-no-container-use.jpg"></li>
<li><p>ç¤ºä¾‹ 4ï¼š<br>ğŸ‘‰ ç”±äºä» <code>dockerbub</code> ä¸Šç›´æ¥æ‹‰å–çš„é•œåƒä¸º <code>docker image format</code>ï¼Œæ— æ³•ä½¿ç”¨ <code>podman commit</code> å‘½ä»¤æäº¤ä¸ºæ–°çš„å®¹å™¨é•œåƒï¼Œè¯¥å‘½ä»¤å¯¹äº <code>-m</code> é€‰é¡¹ä¸èƒ½å¯¹ docker image format é•œåƒç”Ÿæ•ˆï¼Œé»˜è®¤åªæ”¯æŒ <code>OCI image format</code>ï¼Œå› æ­¤ä½¿ç”¨ -m é€‰é¡¹å¯¹å®¹å™¨æ‰§è¡Œæäº¤æ—¶éœ€å¼ºåˆ¶æŒ‡å®š <code>-f docker</code> æ‰èƒ½ç”Ÿæ•ˆã€‚</p>
<blockquote>
<p>ğŸ“Œ<strong>æ³¨æ„ï¼š</strong></p>
<p>å¯ä½¿ç”¨ <code>skopeo</code> å·¥å…·è½¬æ¢ docker image format ä¸ OCI image formatã€‚</p>
</blockquote>
<p><img src="podman-commit-warning.jpg" alt="podman-commit-warning.jpg"></p>
</li>
<li><p>ç¤ºä¾‹ 5ï¼š<br>ğŸ‘‰ podman è¿è¡Œ rootfull æˆ– rootless busybox å®¹å™¨åï¼Œ<code>ping</code> å¤–ç½‘æŠ¥é”™æƒé™é—®é¢˜æ— æ³• ping é€šå¤–ç½‘ï¼Œä½†ä½¿ç”¨å…¶ä»–å·¥å…·å¯ä¸å¤–ç½‘é€šä¿¡ï¼Œé€šè¿‡ <a href="https://www.redhat.com/sysadmin/container-networking-podman" target="_blank" rel="noopener">è¯¥æ–‡æ¡£</a> ä¸­å¯çŸ¥ï¼Œping å‘½ä»¤å¯¹ <code>capability</code> æ•æ„Ÿï¼Œå®¹å™¨å¯èƒ½ç¼ºå°‘ <code>CAP_NET_RAW</code>capability æ— æ³•é€šè¿‡å®¿ä¸»æœº ping é€šå¤–ç½‘ã€‚<br>ğŸ‘‰ å½“ç„¶ï¼Œè¿è¡Œå®¹å™¨æ—¶æŒ‡å®š <code>--privileged</code> é€‰é¡¹å¯ä½¿å®¹å™¨è·å¾—ä¸å®¿ä¸»æœº root ç”¨æˆ·åŒæ ·çš„ä¸å®¿ä¸»æœºäº¤äº’çš„æƒé™èƒ½åŠ›ï¼Œä½†èµ‹äºˆçš„æƒé™è¿‡é«˜ï¼Œåº”å½“å‹åˆ¶è¯¥æƒé™ï¼Œæ›´å¥½çš„é€‰æ‹©æ˜¯å¯¹è¿è¡Œå®¹å™¨æ·»åŠ é€‚å½“çš„ <code>Linux capabilities</code>ã€‚<img src="podman-busybox-capability.jpg" alt="podman-busybox-capability.jpg"></p>
</li>
</ul>
<h3 id="Podman-æœ‰å¾…æµ‹è¯•åŠŸèƒ½ï¼š"><a href="#Podman-æœ‰å¾…æµ‹è¯•åŠŸèƒ½ï¼š" class="headerlink" title="Podman æœ‰å¾…æµ‹è¯•åŠŸèƒ½ï¼š"></a>Podman æœ‰å¾…æµ‹è¯•åŠŸèƒ½ï¼š</h3><p>Podman æ—¥å¿—é©±åŠ¨ç›®å‰åªæ”¯æŒ <code>k8s-file</code>ã€<code>journald</code> ä¸ <code>none</code>ï¼Œæš‚æ—¶ä¸æ”¯æŒå®¹å™¨æ—¥å¿—çš„ <code>JSON</code> æ ¼å¼è¾“å‡ºï¼Œå› æ­¤ä¸èƒ½ä¸æ—¥å¿—æ”¶é›†å¼•æ“ <code>fluentd</code> é›†æˆï¼Œç”±å…¶å®ç°å°†æ—¥å¿—ä¼ è¾“è‡³ ELK æˆ– EFK è¿›è¡Œé›†ä¸­å¼çš„å­˜å‚¨ä¸ç´¢å¼•ã€‚</p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2022/12/05/loganalyzer-rsyslog-mysql/" data-toggle="tooltip" data-placement="top" title="éƒ¨ç½² loganalyzer ç®¡ç†é›†ä¸­å¼æ—¥å¿—">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2022/12/05/podman-arch-usage/" data-toggle="tooltip" data-placement="top" title="Podman å®¹å™¨åŸç†ä¸ä½¿ç”¨ï¼ˆ1ï¼‰">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#äº‘åŸç”Ÿ" title="äº‘åŸç”Ÿ">äº‘åŸç”Ÿ</a>
                        
                          <a class="tag" href="/tags/#å®¹å™¨" title="å®¹å™¨">å®¹å™¨</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://github.com/Alberthua-Perl" target="_blank">Alberthua</a></li>
                    
                        <li><a href="https://github.com/xwanli0923" target="_blank">xwanli0923</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>









    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/Alberthua-Perl">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Alberthua Blog 2022 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://alberthua-perl.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="https://alberthua-perl.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
