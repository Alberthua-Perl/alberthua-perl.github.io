<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢ä¸–ç•Œï¼ğŸ’ª | Thumbs Up for Cloud Native ğŸ¤˜">
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          Podman å®¹å™¨åŸç†ä¸ä½¿ç”¨ï¼ˆ1ï¼‰ - Alberthua çš„åšå®¢ | Alberthua&#39;s Blog
        
    </title>

    <link rel="canonical" href="https://alberthua-perl.github.io/2022/12/05/podman-arch-usage/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Alberthua Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="https://alberthua-perl.github.io/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('podman-bg.webp')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#äº‘åŸç”Ÿ" title="äº‘åŸç”Ÿ">äº‘åŸç”Ÿ</a>
                        
                          <a class="tag" href="/tags/#å®¹å™¨" title="å®¹å™¨">å®¹å™¨</a>
                        
                    </div>
                    <h1>Podman å®¹å™¨åŸç†ä¸ä½¿ç”¨ï¼ˆ1ï¼‰</h1>
                    <h2 class="subheading">Podman Architecture and Usage (1)</h2>
                    <span class="meta">
                        Posted by Alberthua on
                        2022-12-05
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h3 id="æ–‡æ¡£è¯´æ˜ï¼š"><a href="#æ–‡æ¡£è¯´æ˜ï¼š" class="headerlink" title="æ–‡æ¡£è¯´æ˜ï¼š"></a>æ–‡æ¡£è¯´æ˜ï¼š</h3><ul>
<li>å®éªŒç”¨ OS ç‰ˆæœ¬ï¼š  <ul>
<li>CentOS 7.9ã€RHEL 8.0ã€RHEL 8.2ã€Ubuntu 20.04.3 LTS</li>
</ul>
</li>
<li>å®éªŒç”¨ kernel ç‰ˆæœ¬ï¼š  <ul>
<li>3.10.0-1160.41.1.el7.x86_64  </li>
<li>4.18.0-193.el8.x86_64  </li>
<li>5.14.0-1.el7.elrepo.x86_64</li>
</ul>
</li>
<li>å®éªŒç”¨ Podman ç‰ˆæœ¬ï¼š1.6.4ã€3.2.3ã€3.3.1</li>
<li>å®éªŒç”¨ podman-compose ç‰ˆæœ¬ï¼š0.1.8</li>
<li>å®éªŒç”¨ Docker ç‰ˆæœ¬ï¼š20.10.8</li>
<li>è‹¥æœªåšç‰¹æ®Šè¯´æ˜ï¼Œä»¥ä¸‹ç¤ºä¾‹å‡äº <code>RHEL 8.2</code>ï¼ˆ<code>4.18.0-193.el8.x86_64</code>ï¼‰ä¸Šæ‰§è¡Œï¼ŒPodman ç‰ˆæœ¬ä¸º <code>3.2.3</code>ã€‚</li>
<li>è¯¥æ–‡æ¡£ä¸­æœªæ¶‰åŠ podman å‘½ä»¤çš„åŸºç¡€ä½¿ç”¨æ–¹æ³•ï¼Œå¯å‚é˜… <a href="https://mp.weixin.qq.com/s/MDi4RB5V60EGl3ii9usD0Q" target="_blank" rel="noopener">è¯¥æ–‡æ¡£</a> åŠ ä»¥ç†Ÿæ‚‰ã€‚</li>
<li>ğŸ’¥ é‡è¦æç¤ºï¼šPodman é¡¹ç›®æ­£åœ¨ä¸æ–­æ¼”è¿›ä¸å®Œå–„ä¸­ï¼Œè¯·ä»¥è‡ªèº«ä½¿ç”¨çš„ç‰ˆæœ¬ä¸ºå‡†è¿›è¡Œæµ‹è¯•ä¸ä½¿ç”¨ï¼</li>
</ul>
<h3 id="æ–‡æ¡£ç›®å½•ï¼š"><a href="#æ–‡æ¡£ç›®å½•ï¼š" class="headerlink" title="æ–‡æ¡£ç›®å½•ï¼š"></a>æ–‡æ¡£ç›®å½•ï¼š</h3><ul>
<li>Podman çš„ç‰¹æ€§æ¦‚è¿°</li>
<li>Podman ç‰ˆæœ¬å…¼å®¹æ€§æ¯”è¾ƒ</li>
<li>Podman çš„æ‰©å±•åŠŸèƒ½</li>
<li>Podman åœ¨ä¸åŒ OS ç‰ˆæœ¬ä¸­çš„å®‰è£…</li>
<li>Docker ä¸ Podman è¿›ç¨‹ç®¡ç†æ–¹å¼æ¯”è¾ƒ</li>
<li>Podman çš„ç½‘ç»œå®ç°åŸç†ï¼ˆrootfull ä¸ rootlessï¼‰</li>
<li>Podman çš„ macvlan ç½‘ç»œå®ç°</li>
<li>Podman rootless å®¹å™¨ç”¨æˆ·æ˜ å°„å®ç°æ–¹å¼</li>
<li>å‚è€ƒé“¾æ¥</li>
</ul>
<h3 id="Podman-çš„ç‰¹æ€§æ¦‚è¿°ï¼š"><a href="#Podman-çš„ç‰¹æ€§æ¦‚è¿°ï¼š" class="headerlink" title="Podman çš„ç‰¹æ€§æ¦‚è¿°ï¼š"></a>Podman çš„ç‰¹æ€§æ¦‚è¿°ï¼š</h3><ul>
<li>LXCã€<code>LXD</code>ï¼ˆGo è¯­è¨€å¼€å‘ï¼‰ã€<code>systemd-nspawn</code> å‡å¯ä½œä¸º Linux å®¹å™¨ï¼Œä½†ç¼ºå°‘å®¹å™¨è·¨ä¸»æœºè¿è¡Œä¸åº”ç”¨æ‰“åŒ…çš„èƒ½åŠ›ã€‚</li>
<li>Docker ä¸ Podman å¯ä½¿ç”¨å®¹å™¨é•œåƒå®ç°åº”ç”¨æ‰“åŒ…å‘å¸ƒï¼Œå¿«é€Ÿä¸”è½»é‡ã€‚</li>
<li>Docker ä¸ Podman éƒ½ä½¿ç”¨ <code>runC</code>ï¼ˆGo è¯­è¨€å¼€å‘ï¼‰ä½œä¸ºåº•å±‚ <code>oci-runtime</code>ã€‚</li>
<li>Docker ä¸ Podman éƒ½æ”¯æŒ <code>OCI Image Format</code>ï¼ˆGo è¯­è¨€å¼€å‘ï¼‰ï¼Œéƒ½èƒ½ä½¿ç”¨ DockerHub ä¸Šçš„å®¹å™¨é•œåƒï¼Œè€Œ systemd-nspawn æ— æ³•ä½¿ç”¨å®ƒä»¬çš„é•œåƒã€‚</li>
<li>ğŸ‘‰ Podman ä½¿ç”¨ <code>CNI</code>ï¼ˆGo è¯­è¨€å¼€å‘ï¼‰ä½œä¸º rootfull å®¹å™¨ç½‘ç»œåº•å±‚ï¼Œå®ç°æ¯” Docker ç½‘ç»œå±‚ç•¥å¾®ç®€å•ä½†åŸç†ç›¸åŒã€‚</li>
<li>ç›¸å¯¹äº LXD ä¸ systemd-nspawnï¼ŒCNI å¯ä»¥é¿å…ç¼–å†™å¤§é‡çš„ç½‘ç»œè§„åˆ™ã€‚</li>
<li>ğŸš€ ä¸ºäº†å®ç°æ™®é€šç”¨æˆ· rootless å®¹å™¨ç½‘ç»œï¼ŒPodman å¯ä»¥ä½¿ç”¨ <code>slirp4netns</code> ç¨‹åºï¼Œé¿å… <code>kernel space</code> ä¸­çš„å¤§é‡ <code>veth pair</code> è™šæ‹Ÿæ¥å£çš„å‡ºç°, å¹¶ä¸”æ€§èƒ½æ›´å¥½ã€‚</li>
<li>Docker è¿è¡Œå®¹å™¨å¿…é¡»ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹ä¸”ä½¿ç”¨ root æƒé™ï¼Œå­˜åœ¨ç³»ç»Ÿå®‰å…¨é—®é¢˜ï¼Œè€Œ Podman é’ˆå¯¹æ­¤é—®é¢˜ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªç‰¹æ€§åŠ ä»¥è§£å†³ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š  <ul>
<li>Podman æ”¯æŒæ— å®ˆæŠ¤è¿›ç¨‹ï¼ˆ<code>no-daemon</code>ï¼‰è¿è¡Œå®¹å™¨ã€‚  </li>
<li>Podman æ”¯æŒæ™®é€šç”¨æˆ·è¿è¡Œ <code>rootless</code> å®¹å™¨ï¼Œå³ï¼Œæ™®é€šç”¨æˆ·ç›´æ¥è¿è¡Œå®¹å™¨æ— éœ€ææƒå…·æœ‰ root æƒé™ã€‚</li>
</ul>
</li>
<li>è™½ç„¶ Docker ä¸ Podman çš„å®ç°åŸç†ä¸åŒï¼Œä½†å¯¹äºä½¿ç”¨è€…è€Œè¨€å…¶ CLI ååˆ†ç›¸ä¼¼ï¼Œå¯å¹³æ»‘åœ°ä» Docker è¿‡æ¸¡è‡³ Podmanã€‚</li>
<li>Podman çš„ç›®æ ‡ä¸æ˜¯å®¹å™¨çš„ç¼–æ’ï¼Œç¼–æ’å¯ä»¥ä½¿ç”¨æ›´åŠ ä¸“ä¸šçš„ Kubernetesã€Open Shiftã€Rancher ç­‰ï¼Œä½¿ç”¨ Podman å¯ä»¥æ›´è½»é‡çš„è¿è¡Œå®¹å™¨ä¸”ä¸å— root æƒé™çš„å®‰å…¨é—®é¢˜ï¼Œå³ä¾¿æ˜¯ root ç”¨æˆ·ä¹Ÿæ— æ³•æŸ¥çœ‹å…¶å®ƒæ™®é€šç”¨æˆ·ç©ºé—´ä¸‹çš„å®¹å™¨ï¼ŒPodman é€šè¿‡ <code>user namespace</code> è¿›è¡Œéš”ç¦»ã€‚</li>
<li>ğŸ‘‰ Podman å¯ä½¿ç”¨ <code>systemd service</code> å•å…ƒæ–‡ä»¶ç›´æ¥ç®¡ç†å®¹å™¨ï¼Œå®ç°å®¹å™¨æœåŠ¡éšç³»ç»Ÿå¯åŠ¨è€Œå¯åŠ¨ã€‚</li>
<li>ğŸ‘‰ Podman é‡Œé›†æˆäº† <code>CRIU</code>ï¼Œå› æ­¤ Podman ä¸­çš„å®¹å™¨å¯ä»¥åœ¨å•æœºä¸Šçƒ­è¿ç§»ã€‚</li>
<li>ç”±äº Kubernetes å°†ä» <code>v1.24.x</code> ç‰ˆæœ¬åæ”¾å¼ƒä½¿ç”¨ <code>dockershim</code> æ¥å£å±‚ï¼Œå®¹å™¨è¿è¡Œæ—¶å¯é€‰æ‹©ä½¿ç”¨ <code>Containerd</code> æˆ–è€… <code>CRI-O</code>ï¼Œä¸¤è€…è™½ç„¶å‡æ”¯æŒ OCI image è§„èŒƒï¼Œä½†å®ƒä»¬ä¸æ˜¯é¢å‘ä½¿ç”¨è€…æˆ–å¼€å‘è€…ç›´æ¥ç®¡ç†å®¹å™¨æˆ–é•œåƒçš„å·¥å…·ï¼Œè€Œ Podman å¯ç›´æ¥é¢å‘ä½¿ç”¨è€…æˆ–å¼€å‘è€…æ“ä½œå®¹å™¨æˆ–é•œåƒã€‚</li>
<li>Podman å‘½ä»¤çš„å­è¿›ç¨‹åˆ›å»º pod ä¸å®¹å™¨ã€‚</li>
</ul>
<h3 id="Podman-ç‰ˆæœ¬å…¼å®¹æ€§æ¯”è¾ƒï¼š"><a href="#Podman-ç‰ˆæœ¬å…¼å®¹æ€§æ¯”è¾ƒï¼š" class="headerlink" title="Podman ç‰ˆæœ¬å…¼å®¹æ€§æ¯”è¾ƒï¼š"></a>Podman ç‰ˆæœ¬å…¼å®¹æ€§æ¯”è¾ƒï¼š</h3><ul>
<li>Podman ç‰ˆæœ¬ã€kernel ç‰ˆæœ¬ä¸ OS ç‰ˆæœ¬çš„å…¼å®¹æ€§å°†ç›´æ¥å½±å“æ™®é€šç”¨æˆ·ä½¿ç”¨ rootless å®¹å™¨ã€‚</li>
<li><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œkernel ä¸æ”¯æŒ rootless å®¹å™¨ï¼š<br><img src="centos79-kernel-not-support-podman-rootless.jpg" alt="centos79-kernel-not-support-podman-rootless.jpg"></p>
</li>
<li><p>æ™®é€šç”¨æˆ· rootless å®¹å™¨å…¼å®¹æ€§æ¯”è¾ƒï¼š<br><img src="podman-version-compare.png" alt="podman-version-compare.png"></p>
<blockquote>
<p>ğŸ“Œ<strong>æ³¨æ„ï¼š</strong></p>
<p>rootless å®¹å™¨ç‰¹æ€§å–å†³äº kernel çš„ç‰ˆæœ¬ï¼Œä¸å–å†³äº OS ä¸ Podman çš„ç‰ˆæœ¬ã€‚</p>
</blockquote>
<ul>
<li>ç”±äº <code>user namespace</code> ç‰¹æ€§åœ¨ kernel <code>4.9.0</code> ä¹‹åå‡ºç°ï¼Œå› æ­¤å‡çº§ kernel å³å¯è§£å†³ rootless é—®é¢˜ã€‚</li>
<li>å…³äº rootless ç‰¹æ€§åœ¨ RHEL 8 ä¸­çš„è®¾ç½®ï¼Œå¯ <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/building_running_and_managing_containers/assembly_starting-with-containers_building-running-and-managing-containers#proc_setting-up-rootless-containers_assembly_starting-with-containers" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„</a> å‚è€ƒ Red Hat çš„å®˜æ–¹é…ç½®è¯´æ˜ã€‚</li>
</ul>
</li>
</ul>
<h3 id="Podman-çš„æ‰©å±•åŠŸèƒ½ï¼š"><a href="#Podman-çš„æ‰©å±•åŠŸèƒ½ï¼š" class="headerlink" title="Podman çš„æ‰©å±•åŠŸèƒ½ï¼š"></a>Podman çš„æ‰©å±•åŠŸèƒ½ï¼š</h3><ul>
<li><p><code>cockpit-podman</code> è½¯ä»¶åŒ…ä½œä¸º cockpit æ’ä»¶å¯é›†æˆäº <code>Web UI</code> ä¸­ï¼Œå®ç° Web UI ç®¡ç†å®¹å™¨ã€‚  </p>
<ul>
<li><p>cockpit-podman æœåŠ¡å®‰è£…ä¸å¯ç”¨ï¼š    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y cockpit-podman</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> --now cockpit.socket</span><br><span class="line">$ sudo systemctl status cockpit.service</span><br><span class="line"><span class="comment"># å®‰è£… cockpit-podman è½¯ä»¶åŒ…ï¼Œå¹¶å¯ç”¨ cockpit æœåŠ¡ã€‚</span></span><br><span class="line">$ sudo netstat -tunlp | grep 9090</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ systemd ç›‘å¬çš„ 9090 ç«¯å£æ˜¯å¦å¯ç”¨</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ Web UI ä¸­å¯æŸ¥çœ‹å¹¶ç®¡ç† podman å®¹å™¨ä¸é•œåƒï¼š<br><img src="cockpit-podman-1.jpg" alt="podman-arch-usage/cockpit-podman-1.jpg"><img src="cockpit-podman-2.jpg" alt="cockpit-podman-2.jpg"></p>
</li>
</ul>
</li>
<li><code>podman-compose</code> æ—¨åœ¨ä½¿ç”¨æ›´è½»é‡çš„æ–¹å¼å®ç°<code>å•æœºå®¹å™¨ç¼–æ’</code>ï¼Œä»¥ç”¨äºæ›¿æ¢ <code>docker-compose</code>ï¼Œè¿™ç§æ–¹å¼å°†ä¸å†ä¾èµ–å®ˆæŠ¤è¿›ç¨‹ä¸ root æƒé™ï¼ŒåŒæ—¶å¯ä½¿ç”¨ rootless å®¹å™¨ï¼Œè¯¦ç»†ç¤ºä¾‹è§ä¸‹æ–‡ã€‚</li>
<li>podman-compose ä½¿ç”¨ <code>Python</code> å¼€å‘ï¼Œå› æ­¤å¯ç›´æ¥ä½¿ç”¨ <code>pip3</code> å®‰è£…è¯¥ç»„ä»¶ï¼Œæˆ–ä½¿ç”¨ rpm è½¯ä»¶åŒ…æ–¹å¼å®‰è£…ã€‚</li>
<li>ç”±äº podman-compose ä¾ç„¶å¤„äº <code>dev</code> é˜¶æ®µï¼Œä»…ä½œä¸ºåŠŸèƒ½æµ‹è¯•ä½¿ç”¨ï¼Œæš‚æœªå—åˆ° GA ç¯å¢ƒæ”¯æŒã€‚</li>
</ul>
<h3 id="Podman-åœ¨ä¸åŒ-OS-ç‰ˆæœ¬ä¸­çš„å®‰è£…ï¼š"><a href="#Podman-åœ¨ä¸åŒ-OS-ç‰ˆæœ¬ä¸­çš„å®‰è£…ï¼š" class="headerlink" title="Podman åœ¨ä¸åŒ OS ç‰ˆæœ¬ä¸­çš„å®‰è£…ï¼š"></a>Podman åœ¨ä¸åŒ OS ç‰ˆæœ¬ä¸­çš„å®‰è£…ï¼š</h3><ul>
<li><p>CentOS 7.x/8.x æˆ– RHEL 7.x/8.x ä¸­ï¼šyum å‘½ä»¤ä½¿ç”¨ podman <code>rpm</code> è½¯ä»¶åŒ…å®‰è£…  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y podman-3.2.3-0.11.module_el8.4.0+942+d25aada8.x86_64</span><br><span class="line"><span class="comment"># å®‰è£… podman æœ€æ–°ç‰ˆæœ¬ï¼Œä½ç‰ˆæœ¬ podman å­˜åœ¨è¾ƒå¤š bugã€‚</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼š</span></span><br><span class="line"><span class="comment">#   1. éœ€é…ç½® CentOS 8 çš„ yum è½¯ä»¶æºä»¥å®‰è£…æœ€æ–°ç‰ˆçš„ podman åŠå…¶ä¾èµ–è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment">#   2. yum å®‰è£… podman æ—¶ä¹Ÿå°†å®‰è£… containernetworking-plugins è½¯ä»¶åŒ…</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ğŸ¤˜ Ubuntu 20.04.2 LTS ä¸­ï¼šapt-get å‘½ä»¤ä½¿ç”¨ podman <code>deb</code> è½¯ä»¶åŒ…å®‰è£…  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ . /etc/os-release</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰çš„ç³»ç»Ÿå‘è¡Œç‰ˆ</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"deb https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_<span class="variable">$&#123;VERSION_ID&#125;</span>/ /"</span> | sudo tee /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list</span><br><span class="line">$ curl -L <span class="string">"https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_<span class="variable">$&#123;VERSION_ID&#125;</span>/Release.key"</span> | sudo apt-key add -</span><br><span class="line"><span class="comment"># æ·»åŠ  podman è½¯ä»¶æºä¸ apt å…¬é’¥</span></span><br><span class="line">$ sudo apt-get update -y</span><br><span class="line">$ sudo apt-get upgrade -y</span><br><span class="line"><span class="comment"># æ›´æ–°ç³»ç»Ÿè½¯ä»¶æºå¹¶å‡çº§ç³»ç»Ÿè½¯ä»¶åŒ…</span></span><br><span class="line">$ sudo apt-get install -y podman</span><br><span class="line">  Reading package lists... Done</span><br><span class="line">  Building dependency tree       </span><br><span class="line">  Reading state information... Done</span><br><span class="line">  ...</span><br><span class="line">  The following NEW packages will be installed:</span><br><span class="line">    catatonit conmon containernetworking-plugins containers-common criu crun fuse-overlayfs fuse3 libfuse3-3 libnet1 libprotobuf-c1</span><br><span class="line">    podman podman-machine-cni podman-plugins</span><br><span class="line">  ...</span><br><span class="line"><span class="comment"># å®‰è£… podman ä¸ç›¸å…³çš„è½¯ä»¶åŒ…ï¼ŒåŒ…æ‹¬ conmonã€containernetworking-pluginsã€crun ç­‰ã€‚</span></span><br></pre></td></tr></table></figure>
<p>å®‰è£…å‚è€ƒé“¾æ¥ï¼š  </p>
<ul>
<li><a href="https://podman.io/getting-started/installation" target="_blank" rel="noopener">Podman Doc - installation</a></li>
<li><a href="https://www.hostnextra.com/kb/easy-to-install-podman-on-ubuntu-20-04/" target="_blank" rel="noopener">Easy to Install Podman on Ubuntu 20.04</a></li>
<li><a href="https://software.opensuse.org//download.html?project=devel%3Akubic%3Alibcontainers%3Astable&amp;package=podman" target="_blank" rel="noopener">podman from devel:kubic:libcontainers:stable project</a></li>
</ul>
</li>
</ul>
<h3 id="ğŸ¤˜-Docker-ä¸-Podman-è¿›ç¨‹ç®¡ç†æ–¹å¼æ¯”è¾ƒï¼š"><a href="#ğŸ¤˜-Docker-ä¸-Podman-è¿›ç¨‹ç®¡ç†æ–¹å¼æ¯”è¾ƒï¼š" class="headerlink" title="ğŸ¤˜ Docker ä¸ Podman è¿›ç¨‹ç®¡ç†æ–¹å¼æ¯”è¾ƒï¼š"></a>ğŸ¤˜ Docker ä¸ Podman è¿›ç¨‹ç®¡ç†æ–¹å¼æ¯”è¾ƒï¼š</h3><ul>
<li><p>Docker v20.10.8 ä½¿ç”¨ <code>dockerd</code> ä¸ <code>containerd</code> å®ˆæŠ¤è¿›ç¨‹ç®¡ç†å®¹å™¨ä¸é•œåƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿è¡ŒçŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl status docker.service</span><br><span class="line">â— docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Wed 2022-10-19 10:53:04 CST; 6min ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 79556 (dockerd)</span><br><span class="line">    Tasks: 21</span><br><span class="line">   Memory: 42.6M</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           â”œâ”€79556 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">           â”œâ”€79677 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 4000 -container-ip 172.17.0.2 -container-port 4000</span><br><span class="line">           â””â”€79683 /usr/bin/docker-proxy -proto tcp -host-ip :: -host-port 4000 -container-ip 172.17.0.2 -container-port 4000</span><br><span class="line"></span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.197803867+08:00"</span> level=info msg=<span class="string">"scheme \"unix\" not registered, fallback to default scheme"</span> module=grpc</span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.197837924+08:00"</span> level=info msg=<span class="string">"ccResolverWrapper: sending update to cc: &#123;[&#123;unix:///run/containerd/containerd.sock  &lt;nil&gt; 0 &lt;nil&gt;&#125;] &lt;nil&gt; &lt;nil&gt;&#125;"</span> module=grpc</span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.197860326+08:00"</span> level=info msg=<span class="string">"ClientConn switching balancer to \"pick_first\""</span> module=grpc</span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.220416627+08:00"</span> level=info msg=<span class="string">"Loading containers: start."</span></span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.347884960+08:00"</span> level=info msg=<span class="string">"Default bridge (docker0) is assigned with an IP address 172.17.0.0/16. Daemon option --bip can be used to set a preferred IP address"</span></span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.725361851+08:00"</span> level=info msg=<span class="string">"Loading containers: done."</span></span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.755449128+08:00"</span> level=info msg=<span class="string">"Docker daemon"</span> commit=75249d8 graphdriver(s)=overlay2 version=20.10.8</span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.755527994+08:00"</span> level=info msg=<span class="string">"Daemon has completed initialization"</span></span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com systemd[1]: Started Docker Application Container Engine.</span><br><span class="line">Oct 19 10:53:04 cloud-ctl.domain12.example.com dockerd[79556]: time=<span class="string">"2022-10-19T10:53:04.776865058+08:00"</span> level=info msg=<span class="string">"API listen on /var/run/docker.sock"</span></span><br><span class="line"><span class="comment"># dockerd å®ˆæŠ¤è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">$ sudo systemctl status containerd</span><br><span class="line">â— containerd.service - containerd container runtime</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/containerd.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Tue 2022-10-18 15:08:06 CST; 20h ago</span><br><span class="line">     Docs: https://containerd.io</span><br><span class="line"> Main PID: 1892 (containerd)</span><br><span class="line">    Tasks: 20</span><br><span class="line">   Memory: 103.4M</span><br><span class="line">   CGroup: /system.slice/containerd.service</span><br><span class="line">           â”œâ”€ 1892 /usr/bin/containerd</span><br><span class="line">           â””â”€79696 /usr/bin/containerd-shim-runc-v2 -namespace moby -id 3ea752c1cce6a65b39af7f68c971186e020992514b663ab7a917f47da70450fa -address /run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># containerd é€šè¿‡è°ƒç”¨ containerd-shim-runc-v2 è¿è¡ŒæŒ‡å®šå®¹å™¨</span></span><br><span class="line">$ sudo ps -ef | grep -E <span class="string">"dockerd|containerd|containerd-shim-runc-v2"</span></span><br><span class="line">  root       1892      1  0 Oct18 ?        00:05:01 /usr/bin/containerd</span><br><span class="line">  root      79556      1  0 10:53 ?        00:00:03 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">  root      79696      1  0 10:53 ?        00:00:01 /usr/bin/containerd-shim-runc-v2 -namespace moby -id 3ea752c1cce6a65b39af7f68c971186e020992514b663ab7a917f47da70450fa -address /run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># PID 79696 ä¸ºå®é™…çš„å®¹å™¨è¿è¡Œè¿›ç¨‹</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Podman ä¸ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œæˆ–ç®¡ç†å®¹å™¨ï¼Œå¯¹äº rootfull å®¹å™¨æˆ– rootless å®¹å™¨çš„è¿è¡Œæ–¹å¼å­˜åœ¨å·®å¼‚ï¼š  </p>
<ul>
<li><p>rootfull å®¹å™¨çš„è¿›ç¨‹ï¼š<br>ğŸ‘‰ ä»¥äº¤äº’å¼æ–¹å¼è¿è¡Œçš„å®¹å™¨è¿›ç¨‹çŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ps -ef | egrep <span class="string">"podman|slirp4netns|conmon"</span></span><br><span class="line">  root        3879    3476  1 06:31 pts/3    00:00:00 podman run -it --name=mydebian docker.io/library/debian:latest /bin/sh</span><br><span class="line">  root        3945       1  0 06:31 ?        00:00:00 /usr/bin/conmon --api-version 1 -c 29260258303cef76f1191c8b83f16eb7ba70c5424bb17a729e2d3b051680adba -u 29260258303cef76f1191c8b83f16eb7ba70c5424bb17a729e2d3b051680adba -r /usr/bin/crun -b /var/lib/containers/storage/overlay-containers/29260258303cef76f1191c8b83f16eb7ba70c5424bb17a729e2d3b051680adba/userdata -p /run/containers/storage/overlay-containers/29260258303cef76f1191c8b83f16eb7ba70c5424bb17a729e2d3b051680adba/userdata/pidfile -n mydebian --<span class="built_in">exit</span>-dir /run/libpod/exits --full-attach -s -l journald --<span class="built_in">log</span>-level warning --runtime-arg --<span class="built_in">log</span>-format=json --runtime-arg --<span class="built_in">log</span> --runtime-arg=/run/containers/storage/overlay-containers/29260258303cef76f1191c8b83f16eb7ba70c5424bb17a729e2d3b051680adba/userdata/oci-log -t --conmon-pidfile /run/containers/storage/overlay-containers/29260258303cef76f1191c8b83f16eb7ba70c5424bb17a729e2d3b051680adba/userdata/conmon.pid --<span class="built_in">exit</span>-command /usr/bin/podman --<span class="built_in">exit</span>-command-arg --root --<span class="built_in">exit</span>-command-arg /var/lib/containers/storage --<span class="built_in">exit</span>-command-arg --runroot --<span class="built_in">exit</span>-command-arg /run/containers/storage --<span class="built_in">exit</span>-command-arg --<span class="built_in">log</span>-level --<span class="built_in">exit</span>-command-arg warning --<span class="built_in">exit</span>-command-arg --cgroup-manager --<span class="built_in">exit</span>-command-arg systemd --<span class="built_in">exit</span>-command-arg --tmpdir --<span class="built_in">exit</span>-command-arg /run/libpod --<span class="built_in">exit</span>-command-arg --network-config-dir --<span class="built_in">exit</span>-command-arg  --<span class="built_in">exit</span>-command-arg --network-backend --<span class="built_in">exit</span>-command-arg cni --<span class="built_in">exit</span>-command-arg --volumepath --<span class="built_in">exit</span>-command-arg /var/lib/containers/storage/volumes --<span class="built_in">exit</span>-command-arg --runtime --<span class="built_in">exit</span>-command-arg crun --<span class="built_in">exit</span>-command-arg --storage-driver --<span class="built_in">exit</span>-command-arg overlay --<span class="built_in">exit</span>-command-arg --storage-opt --<span class="built_in">exit</span>-command-arg overlay.mountopt=nodev,metacopy=on --<span class="built_in">exit</span>-command-arg --events-backend --<span class="built_in">exit</span>-command-arg journald --<span class="built_in">exit</span>-command-arg container --<span class="built_in">exit</span>-command-arg cleanup --<span class="built_in">exit</span>-command-arg 29260258303cef76f1191c8b83f16eb7ba70c5424bb17a729e2d3b051680adba</span><br><span class="line"><span class="comment"># ç”±äºå…·æœ‰äº¤äº’å¼å‘½ä»¤è¡Œè¿è¡Œä¾ç„¶ä¿ç•™ podman è¿›ç¨‹</span></span><br></pre></td></tr></table></figure>
<p>ğŸ‘‰ ä»¥ <code>detach</code> æ–¹å¼ï¼ˆåå°ï¼‰è¿è¡Œçš„å®¹å™¨è¿›ç¨‹çŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ps -ef | egrep <span class="string">"podman|slirp4netns|conmon"</span></span><br><span class="line">  root        3744       1  0 06:25 ?        00:00:00 /usr/bin/conmon --api-version 1 -c b8ad3fce848ef26197a1d8bd43be5a2a72c66211e05cd90ccfaa55e1515ed272 -u b8ad3fce848ef26197a1d8bd43be5a2a72c66211e05cd90ccfaa55e1515ed272 -r /usr/bin/crun -b /var/lib/containers/storage/overlay-containers/b8ad3fce848ef26197a1d8bd43be5a2a72c66211e05cd90ccfaa55e1515ed272/userdata -p /run/containers/storage/overlay-containers/b8ad3fce848ef26197a1d8bd43be5a2a72c66211e05cd90ccfaa55e1515ed272/userdata/pidfile -n apache-rhce8.2-alpine --<span class="built_in">exit</span>-dir /run/libpod/exits --full-attach -s -l journald --<span class="built_in">log</span>-level warning --runtime-arg --<span class="built_in">log</span>-format=json --runtime-arg --<span class="built_in">log</span> --runtime-arg=/run/containers/storage/overlay-containers/b8ad3fce848ef26197a1d8bd43be5a2a72c66211e05cd90ccfaa55e1515ed272/userdata/oci-log --conmon-pidfile /run/containers/storage/overlay-containers/b8ad3fce848ef26197a1d8bd43be5a2a72c66211e05cd90ccfaa55e1515ed272/userdata/conmon.pid --<span class="built_in">exit</span>-command /usr/bin/podman --<span class="built_in">exit</span>-command-arg --root --<span class="built_in">exit</span>-command-arg /var/lib/containers/storage --<span class="built_in">exit</span>-command-arg --runroot --<span class="built_in">exit</span>-command-arg /run/containers/storage --<span class="built_in">exit</span>-command-arg --<span class="built_in">log</span>-level --<span class="built_in">exit</span>-command-arg warning --<span class="built_in">exit</span>-command-arg --cgroup-manager --<span class="built_in">exit</span>-command-arg systemd --<span class="built_in">exit</span>-command-arg --tmpdir --<span class="built_in">exit</span>-command-arg /run/libpod --<span class="built_in">exit</span>-command-arg --network-config-dir --<span class="built_in">exit</span>-command-arg  --<span class="built_in">exit</span>-command-arg --network-backend --<span class="built_in">exit</span>-command-arg cni --<span class="built_in">exit</span>-command-arg --volumepath --<span class="built_in">exit</span>-command-arg /var/lib/containers/storage/volumes --<span class="built_in">exit</span>-command-arg --runtime --<span class="built_in">exit</span>-command-arg crun --<span class="built_in">exit</span>-command-arg --storage-driver --<span class="built_in">exit</span>-command-arg overlay --<span class="built_in">exit</span>-command-arg --storage-opt --<span class="built_in">exit</span>-command-arg overlay.mountopt=nodev,metacopy=on --<span class="built_in">exit</span>-command-arg --events-backend --<span class="built_in">exit</span>-command-arg journald --<span class="built_in">exit</span>-command-arg container --<span class="built_in">exit</span>-command-arg cleanup --<span class="built_in">exit</span>-command-arg b8ad3fce848ef26197a1d8bd43be5a2a72c66211e05cd90ccfaa55e1515ed272</span><br><span class="line"><span class="comment"># podman åœ¨è°ƒç”¨ conmon ç¨‹åºåˆ›å»ºå¹¶è¿è¡Œå®¹å™¨åé€€å‡ºï¼Œè€Œ rootfull å®¹å™¨çš„ CNI æ’ä»¶</span></span><br><span class="line"><span class="comment"># å¯ç›´æ¥ä½¿ç”¨ iptables çš„æ–¹å¼å®ç°ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>rootless å®¹å™¨çš„è¿›ç¨‹ï¼š<br>ğŸ‘‰ ä»¥äº¤äº’å¼æ–¹å¼è¿è¡Œçš„å®¹å™¨è¿›ç¨‹çŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | egrep <span class="string">"podman|slirp4netns|conmon"</span></span><br><span class="line">  core        3418    2762  0 06:17 pts/2    00:00:05 podman run -it --name=mybusybox docker.io/library/busybox:latest /bin/sh</span><br><span class="line">  core        3430    3418  0 06:17 pts/2    00:00:00 /usr/bin/slirp4netns --<span class="built_in">disable</span>-host-loopback --mtu=65520 --<span class="built_in">enable</span>-sandbox --<span class="built_in">enable</span>-seccomp --<span class="built_in">enable</span>-ipv6 -c -e 3 -r 4 --netns-type=path /run/user/1000/netns/netns-19eb5630-c0a8-4ea9-8790-76ecdcdf2dbc tap0</span><br><span class="line">  core        3433       1  0 06:17 ?        00:00:00 /usr/bin/conmon --api-version 1 -c 5acc7fc4127d5492866b966d6c0c04dce880995c49eddb8421c11e7efc661160 -u 5acc7fc4127d5492866b966d6c0c04dce880995c49eddb8421c11e7efc661160 -r /usr/bin/crun -b /var/home/core/.<span class="built_in">local</span>/share/containers/storage/overlay-containers/5acc7fc4127d5492866b966d6c0c04dce880995c49eddb8421c11e7efc661160/userdata -p /run/user/1000/containers/overlay-containers/5acc7fc4127d5492866b966d6c0c04dce880995c49eddb8421c11e7efc661160/userdata/pidfile -n mybusybox --<span class="built_in">exit</span>-dir /run/user/1000/libpod/tmp/exits --full-attach -s -l journald --<span class="built_in">log</span>-level warning --runtime-arg --<span class="built_in">log</span>-format=json --runtime-arg --<span class="built_in">log</span> --runtime-arg=/run/user/1000/containers/overlay-containers/5acc7fc4127d5492866b966d6c0c04dce880995c49eddb8421c11e7efc661160/userdata/oci-log -t --conmon-pidfile /run/user/1000/containers/overlay-containers/5acc7fc4127d5492866b966d6c0c04dce880995c49eddb8421c11e7efc661160/userdata/conmon.pid --<span class="built_in">exit</span>-command /usr/bin/podman --<span class="built_in">exit</span>-command-arg --root --<span class="built_in">exit</span>-command-arg /var/home/core/.<span class="built_in">local</span>/share/containers/storage --<span class="built_in">exit</span>-command-arg --runroot --<span class="built_in">exit</span>-command-arg /run/user/1000/containers --<span class="built_in">exit</span>-command-arg --<span class="built_in">log</span>-level --<span class="built_in">exit</span>-command-arg warning --<span class="built_in">exit</span>-command-arg --cgroup-manager --<span class="built_in">exit</span>-command-arg systemd --<span class="built_in">exit</span>-command-arg --tmpdir --<span class="built_in">exit</span>-command-arg /run/user/1000/libpod/tmp --<span class="built_in">exit</span>-command-arg --network-config-dir --<span class="built_in">exit</span>-command-arg  --<span class="built_in">exit</span>-command-arg --network-backend --<span class="built_in">exit</span>-command-arg netavark --<span class="built_in">exit</span>-command-arg --volumepath --<span class="built_in">exit</span>-command-arg /var/home/core/.<span class="built_in">local</span>/share/containers/storage/volumes --<span class="built_in">exit</span>-command-arg --runtime --<span class="built_in">exit</span>-command-arg crun --<span class="built_in">exit</span>-command-arg --storage-driver --<span class="built_in">exit</span>-command-arg overlay --<span class="built_in">exit</span>-command-arg --events-backend --<span class="built_in">exit</span>-command-arg journald --<span class="built_in">exit</span>-command-arg container --<span class="built_in">exit</span>-command-arg cleanup --<span class="built_in">exit</span>-command-arg 5acc7fc4127d5492866b966d6c0c04dce880995c49eddb8421c11e7efc661160</span><br><span class="line"><span class="comment"># ç”±äºå…·æœ‰äº¤äº’å¼å‘½ä»¤è¡Œè¿è¡Œä¾ç„¶ä¿ç•™ podman è¿›ç¨‹ï¼Œå¹¶ä¸”ç”± podman è¿›ç¨‹åˆ›å»º slirp4netns å­è¿›ç¨‹</span></span><br><span class="line"><span class="comment"># ç”¨äº rootless å®¹å™¨çš„ç½‘ç»œå‘½åç©ºé—´ä¹‹é—´çš„é€šä¿¡ã€‚</span></span><br><span class="line">``` </span><br><span class="line">ğŸ‘‰ ä»¥ `detach` æ–¹å¼ï¼ˆåå°ï¼‰è¿è¡Œçš„å®¹å™¨è¿›ç¨‹çŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š   </span><br><span class="line">```bash</span><br><span class="line">$ ps -ef | egrep <span class="string">"podman|slirp4netns|conmon"</span></span><br><span class="line">  core        3308       1  0 06:15 pts/2    00:00:00 /usr/bin/slirp4netns --<span class="built_in">disable</span>-host-loopback --mtu=65520 --<span class="built_in">enable</span>-sandbox --<span class="built_in">enable</span>-seccomp --<span class="built_in">enable</span>-ipv6 -c -e 3 -r 4 --netns-type=path /run/user/1000/netns/netns-f9f6f9dd-bf80-f6ca-6f39-7c9d9cd6beea tap0</span><br><span class="line">  core        3325       1  0 06:15 ?        00:00:00 /usr/bin/conmon --api-version 1 -c 91b49d5726023b9ca1c4e30a6665fc21c9b3c3182a1accddb0adb259d0ba20ab -u 91b49d5726023b9ca1c4e30a6665fc21c9b3c3182a1accddb0adb259d0ba20ab -r /usr/bin/crun -b /var/home/core/.<span class="built_in">local</span>/share/containers/storage/overlay-containers/91b49d5726023b9ca1c4e30a6665fc21c9b3c3182a1accddb0adb259d0ba20ab/userdata -p /run/user/1000/containers/overlay-containers/91b49d5726023b9ca1c4e30a6665fc21c9b3c3182a1accddb0adb259d0ba20ab/userdata/pidfile -n apache-rhce8.2-alpine --<span class="built_in">exit</span>-dir /run/user/1000/libpod/tmp/exits --full-attach -s -l journald --<span class="built_in">log</span>-level warning --runtime-arg --<span class="built_in">log</span>-format=json --runtime-arg --<span class="built_in">log</span> --runtime-arg=/run/user/1000/containers/overlay-containers/91b49d5726023b9ca1c4e30a6665fc21c9b3c3182a1accddb0adb259d0ba20ab/userdata/oci-log --conmon-pidfile /run/user/1000/containers/overlay-containers/91b49d5726023b9ca1c4e30a6665fc21c9b3c3182a1accddb0adb259d0ba20ab/userdata/conmon.pid --<span class="built_in">exit</span>-command /usr/bin/podman --<span class="built_in">exit</span>-command-arg --root --<span class="built_in">exit</span>-command-arg /var/home/core/.<span class="built_in">local</span>/share/containers/storage --<span class="built_in">exit</span>-command-arg --runroot --<span class="built_in">exit</span>-command-arg /run/user/1000/containers --<span class="built_in">exit</span>-command-arg --<span class="built_in">log</span>-level --<span class="built_in">exit</span>-command-arg warning --<span class="built_in">exit</span>-command-arg --cgroup-manager --<span class="built_in">exit</span>-command-arg systemd --<span class="built_in">exit</span>-command-arg --tmpdir --<span class="built_in">exit</span>-command-arg /run/user/1000/libpod/tmp --<span class="built_in">exit</span>-command-arg --network-config-dir --<span class="built_in">exit</span>-command-arg  --<span class="built_in">exit</span>-command-arg --network-backend --<span class="built_in">exit</span>-command-arg netavark --<span class="built_in">exit</span>-command-arg --volumepath --<span class="built_in">exit</span>-command-arg /var/home/core/.<span class="built_in">local</span>/share/containers/storage/volumes --<span class="built_in">exit</span>-command-arg --runtime --<span class="built_in">exit</span>-command-arg crun --<span class="built_in">exit</span>-command-arg --storage-driver --<span class="built_in">exit</span>-command-arg overlay --<span class="built_in">exit</span>-command-arg --events-backend --<span class="built_in">exit</span>-command-arg journald --<span class="built_in">exit</span>-command-arg container --<span class="built_in">exit</span>-command-arg cleanup --<span class="built_in">exit</span>-command-arg 91b49d5726023b9ca1c4e30a6665fc21c9b3c3182a1accddb0adb259d0ba20ab</span><br><span class="line"><span class="comment"># podman åœ¨è°ƒç”¨ conmon ç¨‹åºåˆ›å»ºå¹¶è¿è¡Œå®¹å™¨åé€€å‡ºï¼Œå¹¶ä¸”ç”± podman è¿›ç¨‹åˆ›å»º slirp4netns å­è¿›ç¨‹</span></span><br><span class="line"><span class="comment"># ç”¨äº rootless å®¹å™¨çš„ç½‘ç»œå‘½åç©ºé—´ä¹‹é—´çš„é€šä¿¡ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="Podman-çš„ç½‘ç»œå®ç°åŸç†ï¼ˆrootfull-ä¸-rootlessï¼‰ï¼š"><a href="#Podman-çš„ç½‘ç»œå®ç°åŸç†ï¼ˆrootfull-ä¸-rootlessï¼‰ï¼š" class="headerlink" title="Podman çš„ç½‘ç»œå®ç°åŸç†ï¼ˆrootfull ä¸ rootlessï¼‰ï¼š"></a>Podman çš„ç½‘ç»œå®ç°åŸç†ï¼ˆrootfull ä¸ rootlessï¼‰ï¼š</h3><ul>
<li>Podman æ”¯æŒçš„å®¹å™¨ç½‘ç»œæ¨¡å¼å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="podman-network-mode.jpg" alt="podman-network-mode.jpg"></li>
<li><p>root ç”¨æˆ·è¿è¡Œ rootfull å®¹å™¨ç½‘ç»œåˆ†æï¼š  </p>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œrootfull å®¹å™¨ä½¿ç”¨ bridge ç½‘ç»œæ¨¡å¼ï¼Œå¹¶ä¸”åœ¨æœªåˆ›å»ºä»»ä½•å®¹å™¨å‰ç³»ç»Ÿä¸Šä¸ä¼šè‡ªåŠ¨åˆ›å»º <code>cni-podman0</code>ç½‘æ¡¥ï¼Œåªæœ‰åˆ›å»ºå®¹å™¨åè‡ªåŠ¨ç”Ÿæˆã€‚  </li>
<li><p>root ç”¨æˆ·ä½¿ç”¨å…¨å±€èŒƒå›´å†…çš„ CNI æ’ä»¶ï¼Œpodman é»˜è®¤ä½¿ç”¨ <code>bridge</code>ã€<code>portmap</code> æ’ä»¶ï¼Œå…¶é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/cni/net.d/87-podman-bridge.conflist</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"cniVersion"</span>: <span class="string">"0.4.0"</span>,</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"podman"</span>,</span><br><span class="line">  <span class="string">"plugins"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">      <span class="string">"bridge"</span>: <span class="string">"cni-podman0"</span>,</span><br><span class="line">      <span class="string">"isGateway"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"ipMasq"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"hairpinMode"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"ipam"</span>: &#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"host-local"</span>,</span><br><span class="line">        <span class="string">"routes"</span>: [&#123; <span class="string">"dst"</span>: <span class="string">"0.0.0.0/0"</span> &#125;],</span><br><span class="line">        <span class="string">"ranges"</span>: [</span><br><span class="line">          [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"subnet"</span>: <span class="string">"10.88.0.0/16"</span>,</span><br><span class="line">              <span class="string">"gateway"</span>: <span class="string">"10.88.0.1"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"portmap"</span>,</span><br><span class="line">      <span class="string">"capabilities"</span>: &#123;</span><br><span class="line">        <span class="string">"portMappings"</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"firewall"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"tuning"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line"><span class="comment"># è¯¥é…ç½®æ–‡ä»¶ä½äº Podman æºç  cni/87-podman-bridge.conflist</span></span><br><span class="line"><span class="comment"># Podman å¯è°ƒç”¨ bridgeã€portmap ç­‰ CNI æ’ä»¶</span></span><br><span class="line"></span><br><span class="line">$ sudo podman inspect &lt;container_name&gt; | jq .[0].HostConfig.NetworkMode</span><br><span class="line">  <span class="string">"bridge"</span></span><br><span class="line"><span class="comment"># root ç”¨æˆ·åˆ›å»ºçš„å®¹å™¨ç½‘ç»œæ¨¡å¼</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>root ç”¨æˆ·åˆ›å»ºå…·æœ‰ç«¯å£æ˜ å°„çš„å®¹å™¨æ—¶ï¼Œiptables filter è¡¨ä¸ nat è¡¨è§„åˆ™å°†ç›¸åº”å¢åŠ ï¼š    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----- filter è¡¨ä¸­åˆ›å»ºæ–°å®¹å™¨åçš„æ–°å¢è§„åˆ™ -----</span></span><br><span class="line">*filter</span><br><span class="line">-A FORWARD -m comment --comment <span class="string">"CNI firewall plugin rules"</span> -j CNI-FORWARD</span><br><span class="line">-A CNI-FORWARD -m comment --comment <span class="string">"CNI firewall plugin admin overrides"</span> -j CNI-ADMIN</span><br><span class="line">-A CNI-FORWARD -d 10.88.0.3/32 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line"><span class="comment"># æ–°å¢è§„åˆ™ï¼šå…è®¸ 3 å±‚è½¬å‘ç›®æ ‡åœ°å€ä¸º 10.88.0.3 çš„æµé‡ï¼ˆè¿›å…¥å®¹å™¨çš„æµé‡ï¼‰ï¼Œconntrack æ¨¡å—è¿›è¡Œè¿æ¥çŠ¶æ€è¿½è¸ªã€‚</span></span><br><span class="line"><span class="comment"># å½“å®¹å™¨é€šè¿‡ MASQUERADE å¯¹å¤–è®¿é—®ï¼Œå›åŒ…å†æ¬¡è¿›å…¥å®¹å™¨å®¿ä¸»æœºæ—¶ä¸å†é€šè¿‡ DNAT è½¬å‘ï¼Œè€Œé€šè¿‡ conntrack </span></span><br><span class="line"><span class="comment"># è®°å½•çš„è¿æ¥çŠ¶æ€ç›´æ¥è½¬å‘è‡³è¯¥è§„åˆ™å¹¶é€šè¿‡ cni-podman0 ç½‘æ¡¥è¿›å…¥å®¹å™¨ã€‚</span></span><br><span class="line">-A CNI-FORWARD -s 10.88.0.3/32 -j ACCEPT</span><br><span class="line"><span class="comment"># æ–°å¢è§„åˆ™ï¼šå…è®¸ 3 å±‚è½¬å‘æºåœ°å€ä¸º 10.88.0.3 çš„æµé‡ï¼ˆå‡ºå®¹å™¨çš„æµé‡ï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----- nat è¡¨ä¸­åˆ›å»ºæ–°å®¹å™¨åçš„æ–°å¢è§„åˆ™ -----</span></span><br><span class="line">*nat</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j CNI-HOSTPORT-DNAT</span><br><span class="line">-A POSTROUTING -m comment --comment <span class="string">"CNI portfwd requiring masquerade"</span> -j CNI-HOSTPORT-MASQ</span><br><span class="line">-A POSTROUTING -s 10.88.0.3/32 -m comment --comment <span class="string">"name: \"podman\" id: \"2d2b3521457cb1d9b7ae6657304d05789a854e7a48916276a40da543df9aa217\""</span> -j CNI-b6c5fb6c593e895d843cb5bd</span><br><span class="line"><span class="comment"># æ–°å¢è§„åˆ™ï¼šæ¥è‡ªäº 10.88.0.3 å®¹å™¨çš„æµé‡è½¬å‘è‡³ CNI-b6c5fb6c593e895d843cb5bd é“¾</span></span><br><span class="line">-A OUTPUT -m addrtype --dst-type LOCAL -j CNI-HOSTPORT-DNAT</span><br><span class="line"><span class="comment"># å¯ç”¨ CNI åå³åˆ›å»ºçš„è§„åˆ™ï¼Œè¯¥è§„åˆ™æ¥æ”¶æ¥è‡ªæœ¬åœ°åº”ç”¨çš„æµé‡å¹¶è½¬å‘è‡³ CNI-HOSTPORT-DNAT é“¾</span></span><br><span class="line">-A CNI-HOSTPORT-SETMARK -m comment --comment <span class="string">"CNI portfwd masquerade mark"</span> -j MARK --<span class="built_in">set</span>-xmark 0x2000/0x2000</span><br><span class="line">-A CNI-HOSTPORT-MASQ -m mark --mark 0x2000/0x2000 -j MASQUERADE</span><br><span class="line"><span class="comment">### ä»¥ä¸‹ 6 æ¡åœ¨åˆ›å»ºæ–°å®¹å™¨æ—¶åŒæ—¶åˆ›å»º </span></span><br><span class="line">-A CNI-HOSTPORT-DNAT -p tcp -m comment --comment <span class="string">"dnat name: \"podman\" id: \"2d2b3521457cb1d9b7ae6657304d05789a854e7a48916276a40da543df9aa217\""</span> -m multiport --dports 8843 -j CNI-DN-b6c5fb6c593e895d843cb</span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ DNAT é“¾ï¼Œå‘é€è‡³æœ¬åœ° 8843 ç«¯å£çš„æµé‡è½¬å‘è‡³ CNI-DN-b6c5fb6c593e895d843cb é“¾ã€‚</span></span><br><span class="line">-A CNI-b6c5fb6c593e895d843cb5bd -d 10.88.0.0/16 -m comment --comment <span class="string">"name: \"podman\" id: \"2d2b3521457cb1d9b7ae6657304d05789a854e7a48916276a40da543df9aa217\""</span> -j ACCEPT</span><br><span class="line"><span class="comment"># å…è®¸è½¬å‘ç›®æ ‡ç½‘æ®µä¸º 10.88.0.0/16 çš„æµé‡ï¼ˆè¿›å…¥å®¹å™¨çš„æµé‡ï¼‰ï¼Œè¯¥ç½‘æ®µä¸ºå®¹å™¨æ‰€åœ¨çš„ç½‘ç»œã€‚</span></span><br><span class="line">-A CNI-b6c5fb6c593e895d843cb5bd ! -d 224.0.0.0/4 -m comment --comment <span class="string">"name: \"podman\" id: \"2d2b3521457cb1d9b7ae6657304d05789a854e7a48916276a40da543df9aa217\""</span> -j MASQUERADE</span><br><span class="line"><span class="comment"># MASQUERADE å‡ºå®¹å™¨æµé‡</span></span><br><span class="line">-A CNI-DN-b6c5fb6c593e895d843cb -s 10.88.0.0/16 -p tcp -m tcp --dport 8843 -j CNI-HOSTPORT-SETMARK</span><br><span class="line">-A CNI-DN-b6c5fb6c593e895d843cb -s 127.0.0.1/32 -p tcp -m tcp --dport 8843 -j CNI-HOSTPORT-SETMARK</span><br><span class="line">-A CNI-DN-b6c5fb6c593e895d843cb -p tcp -m tcp --dport 8843 -j DNAT --to-destination 10.88.0.3:443</span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ DNAT é“¾å®ç°å®¹å™¨å®¿ä¸»æœºè‡³å®¹å™¨çš„ç«¯å£æ˜ å°„</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ğŸš€ ç¤ºä¾‹ï¼šå¤–éƒ¨è®¿é—®å®¹å™¨å†… Web æœåŠ¡æ—¶ï¼Œæ¶‰åŠçš„å®¿ä¸»æœº iptablesï¼š<br><img src="external-access-container-web-service-iptables.jpg" alt="external-access-container-web-service-iptables.jpg">ä»å¤–éƒ¨è®¿é—®å®¹å™¨å†… Web æœåŠ¡æ—¶ï¼Œæµé‡å°†é€šè¿‡ PREROUTING é“¾åŠè‡ªå®šä¹‰é“¾ï¼ˆ<code>CNI-HOSTPORT-DNAT</code>ã€<code>CNI-DN-xxxx</code>ã€<code>DNAT</code>ï¼‰ï¼Œç»ç”± FORWARD é“¾åŠè‡ªå®šä¹‰é“¾ï¼ˆ<code>CNI-FORWARD</code>ï¼‰çš„ä¸‰å±‚è½¬å‘ä¸ <code>cni-podman0</code> ç½‘æ¡¥çš„äºŒå±‚è½¬å‘è¿›å…¥å®¹å™¨ï¼Œå®¹å™¨å¯¹å¤–å“åº”çš„æµé‡å°†ç»è¿‡ cni-podman0 ç½‘æ¡¥è½¬å‘ï¼Œå¹¶ç»è¿‡ CNI-FORWARD é“¾ä¸ POSTROUTING é“¾åŠè‡ªå®šä¹‰é“¾ï¼ˆ<code>CNI-HOSTPORT-MASQ</code>ï¼‰å‡ºå®¹å™¨å®¿ä¸»æœºã€‚  </p>
</li>
<li><p>ğŸš€ ç¤ºä¾‹ï¼šç›´æ¥ä»å®¹å™¨å†…è®¿é—®å¤–éƒ¨æ—¶ï¼Œè¿”å›å®¹å™¨çš„å›åŒ…å°†ç›´æ¥ä½¿ç”¨ conntrack æ¨¡å—è¿½è¸ªçš„è¿æ¥çŠ¶æ€ï¼Œæµé‡é€šè¿‡ <code>CNI-FORWARD</code> é“¾çš„ä¸‰å±‚è½¬å‘ä¸ cni-podman0 çš„äºŒå±‚è½¬å‘è‡³å®¹å™¨ä¸­ï¼Œå³ï¼Œå›åŒ…è¿›å…¥å®¹å™¨å®¿ä¸»æœºä¸å†é€šè¿‡<code>CNI-HOSTPORT-DNAT</code>é“¾ã€‚<br>å¦‚ä¸‹æ‰€ç¤ºï¼Œç›¸å…³çš„ DNAT é“¾æ— æµé‡é€šè¿‡ï¼ˆè“æ¡†ï¼‰ï¼ŒCNI-FORWARD é“¾å‡æœ‰æµé‡é€šè¿‡ï¼ˆè“æ¡†ï¼‰ã€‚<br><img src="container-access-external-iptables.jpg" alt="container-access-external-iptables.jpg"></p>
<blockquote>
<p>ğŸ“Œ <strong>Kubernetes ç›¸å…³é—®é¢˜æç¤ºï¼š</strong></p>
<ol>
<li>å®¹å™¨æˆ– pod é€šè¿‡ cni ç½‘æ¡¥æ¡¥æ¥çš„æ–¹å¼åœ¨ Kubernetes æˆ– OpenShift3 ä¸­éœ€åœ¨è®¡ç®—èŠ‚ç‚¹ï¼ˆworker nodeï¼‰ä¸Šé…ç½® <code>net.bridge.bridge-nf-call-iptables</code> ä¸ <code>net.bridge.bridge-nf-call-iptables6</code> å†…æ ¸å‚æ•°ï¼Œä½¿ cni äºŒå±‚ç½‘æ¡¥å¯è°ƒç”¨ iptables çš„ conntrack æ¨¡å—ï¼Œä»¥è§£å†³å‰åç«¯ pod åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šæ—¶ï¼Œç”±äº pod ç›´è¿ cni äºŒå±‚ç½‘æ¡¥ï¼Œè€ŒäºŒå±‚ç½‘æ¡¥åªå®ç°äºŒå±‚è½¬å‘ï¼Œæ— æ³•è¿½è¸ªå‰åç«¯çš„è¿æ¥çŠ¶æ€ï¼Œé€ æˆåç«¯ pod å‘å‰ç«¯ pod å›åŒ…æ—¶æ— æ³•å¤„äºåŒä¸€è¿æ¥é“¾è·¯çš„é—®é¢˜ï¼Œå¯ <a href="https://imroc.cc/k8s/faq/why-enable-bridge-nf-call-iptables/" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„</a> è·å¾—æ›´å¤šå¸®åŠ©ã€‚</li>
<li>ä½¿ç”¨ä»¥ä¸Šå†…æ ¸å‚æ•°æ—¶ï¼Œéœ€åŠ è½½ <code>br_netfilter</code> å†…æ ¸æ¨¡å—æ–¹èƒ½ç”Ÿæ•ˆã€‚</li>
</ol>
</blockquote>
</li>
<li><p>ä½¿ç”¨ <code>iperf3</code> å·¥å…·çš„å®¹å™¨æµ‹è¯•ä¸åŒ rootfull å®¹å™¨ä¹‹é—´çš„ç½‘ç»œæ€§èƒ½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="rootfull-container-to-container-bandwidth.jpg" alt="rootfull-container-to-container-bandwidth.jpg"></p>
</li>
</ul>
</li>
<li><p>æ™®é€šç”¨æˆ·è¿è¡Œ rootless å®¹å™¨ç½‘ç»œåˆ†æï¼š  </p>
<ul>
<li><code>slirp4netns</code> ç¨‹åºæ”¯æŒ user rootless network namespaceï¼Œè€Œéé€šè¿‡ <code>iptables</code> ä¸ CNI å®ç°ã€‚  </li>
<li><p>ğŸ‘‰ æ™®é€šç”¨æˆ·ä½¿ç”¨ç«¯å£æ˜ å°„è¿è¡Œ rootless å®¹å™¨æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹åªèƒ½ä½¿ç”¨å®¿ä¸»æœº 1024 ä»¥ä¸Šçš„ç«¯å£å®ç°æ˜ å°„ï¼Œä½†å¯ä½¿ç”¨ <code>net.ipv4.ip_unprivileged_port_start</code> å†…æ ¸å‚æ•°å®ç°ä½äº 1024 çš„ç«¯å£å¼€å§‹æ˜ å°„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### æ–¹å¼ 1ï¼š###</span></span><br><span class="line">$ sysctl -w net.ipv4.ip_unprivileged_port_start=80</span><br><span class="line"><span class="comment"># ä¸´æ—¶é…ç½®ï¼šå…è®¸æ™®é€šç”¨æˆ·ä» 80 ç«¯å£å¼€å§‹çš„ç«¯å£æ˜ å°„è¿è¡Œ rootless å®¹å™¨</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">### æ–¹å¼ 2ï¼š###</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"net.ipv4.ip_unprivileged_port_start=80"</span> &gt;&gt; /etc/sysctl.d/rootless.conf</span><br><span class="line"><span class="comment"># æ°¸ä¹…é…ç½®ï¼šå°†è¯¥å†…æ ¸å‚æ•°å†™å…¥å†…æ ¸å‚æ•°é…ç½®æ–‡ä»¶ï¼Œä½¿å…¶å¼€æœºæ°¸ä¹…ç”Ÿæ•ˆã€‚</span></span><br><span class="line">$ sysctl -p</span><br><span class="line"><span class="comment"># ä½¿é…ç½®çš„å†…æ ¸å‚æ•°ç”Ÿæ•ˆ</span></span><br><span class="line"></span><br><span class="line"> - æ™®é€šç”¨æˆ·åˆ›å»ºçš„å®¹å™¨ç½‘ç»œæ¨¡å¼ä¸º `slirp4netns`ï¼ˆslirp4netns è½¯ä»¶åŒ…å®ç°ï¼‰ã€‚    </span><br><span class="line">    ```bash</span><br><span class="line">    $ podman inspect &lt;container_name&gt; | jq .[0].HostConfig.NetworkMode</span><br><span class="line">      <span class="string">"slirp4netns"</span></span><br><span class="line">    <span class="comment"># æ™®é€šç”¨æˆ·åˆ›å»ºçš„ rootless å®¹å™¨ç½‘ç»œæ¨¡å¼</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¯ä¸ªæ™®é€šç”¨æˆ·è¿è¡Œ rootless å®¹å™¨éƒ½å°†ç”Ÿæˆ slirp4netns è¿›ç¨‹ç”¨äºéš”ç¦»è¯¥ç”¨æˆ·çš„ <code>network namespace</code>ï¼Œä»¥ä¸‹åˆ†åˆ«ä½¿ç”¨ godev ä¸ hualf ç”¨æˆ·è¿è¡Œ rootless å®¹å™¨ï¼š<br><img src="godev-rootless-container.jpg" alt="godev-rootless-container.jpg"><img src="hualf-rootless-container.jpg" alt="hualf-rootless-container.jpg"> </p>
</li>
<li>slirp4netns å®ç°çš„ç½‘ç»œæ¨¡å¼ä¸å¸¦å®½æ¯”è¾ƒï¼š<br><img src="rootless-slirp4netns-networking.jpg" alt="rootless-slirp4netns-networking.jpg"> </li>
<li>ä½¿ç”¨ <code>iperf3</code> å·¥å…·çš„å®¹å™¨æµ‹è¯•ä¸åŒ rootless å®¹å™¨ä¹‹é—´çš„ç½‘ç»œæ€§èƒ½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="rootless-container-to-container-bandwidth.jpg" alt="rootless-container-to-container-bandwidth.jpg">å¯¹æ¯” rootfull å®¹å™¨ä¹‹é—´çš„ç½‘ç»œæ€§èƒ½æ¥çœ‹ï¼Œslirp4netns å®ç°çš„ rootless å®¹å™¨åœ¨ä¸åŒçš„ç½‘ç»œå‘½åç©ºé—´å†…çš„é€šä¿¡æ€§èƒ½æŸè€—è¾ƒå¤§ï¼Œè€Œ rootfull å®¹å™¨ä¹‹é—´çš„ç½‘ç»œæ€§èƒ½ç›¸æ¯”å‰è€…åœ¨æ­¤æ¬¡æµ‹è¯•ä¸­é«˜å‡ºè¿‘ 5 å€ã€‚ </li>
<li>å…³äº slirp4netns æ›´åŠ è¯¦ç»†çš„å†…å®¹ï¼Œè¯·å‚è€ƒ <a href="https://github.com/rootless-containers/slirp4netns" target="_blank" rel="noopener">Github é¡¹ç›®</a>ã€‚</li>
</ul>
</li>
</ul>
<h3 id="Podman-çš„-macvlan-ç½‘ç»œå®ç°ï¼š"><a href="#Podman-çš„-macvlan-ç½‘ç»œå®ç°ï¼š" class="headerlink" title="Podman çš„ macvlan ç½‘ç»œå®ç°ï¼š"></a>Podman çš„ macvlan ç½‘ç»œå®ç°ï¼š</h3><ul>
<li><code>macvlan</code> ä½œä¸º CNI åœ¨ Kubernetes ä¸ OpenShift v4 ä¸­ä½œä¸º <code>Multus CNI</code> æ”¯æŒçš„é¢å¤–æ’ä»¶ç±»å‹ä½¿ç”¨æ„ˆåŠ å¹¿æ³›ï¼Œé›†ç¾¤ä¸­é™¤äº†å¸¸è§„ä½¿ç”¨çš„ Flannelã€Calico ç­‰ä½œä¸º <code>slow path</code> çš„æ’ä»¶å¤–ï¼Œè¦æ±‚é«˜æ€§èƒ½çš„ä¸šåŠ¡æµé‡å¯ä½¿ç”¨ macvlan ç›´è¿ pod å®¿ä¸»æœºç‰©ç†ç½‘å£å®ç° <code>fast path</code>ã€‚</li>
<li>ä¸ºåç»­ç†Ÿæ‚‰ä»¥ä¸Šåœºæ™¯çš„å®ç°ï¼Œå› æ­¤åœ¨ Podman <code>rootfull</code> å®¹å™¨ä¸­ä½¿ç”¨ macvlan ç½‘ç»œæ¨¡å¼ã€‚</li>
<li>å…³äº macvlan çš„åŸºç¡€çŸ¥è¯†å¯å‚è€ƒ <a href="https://mp.weixin.qq.com/s?__biz=MzU1MzY4NzQ1OA==&amp;mid=2247484064&amp;idx=1&amp;sn=ffd745069b6c4aeac0589de00467b2f2&amp;chksm=fbee426dcc99cb7bdf26f5e6a21bbeaebba7ccd384a02f850d4461ea92331ed140edf98ffaec&amp;mpshare=1&amp;scene=1&amp;srcid=03049MKwF55OVgEZ4OCH39wd&amp;sharer_sharetime=1583337046541&amp;sharer_shareid=8eaca72194dae7b3d51d5c708436eee4#rd" target="_blank" rel="noopener">Linux è™šæ‹Ÿç½‘å¡æŠ€æœ¯ï¼šMacvlan</a> ä¸ <a href="https://cizixs.com/2017/02/14/network-virtualization-macvlan/" target="_blank" rel="noopener">linux ç½‘ç»œè™šæ‹ŸåŒ–ï¼šmacvlan</a></li>
<li><p>macvlan ç‰¹æ€§ç”± <code>Linux kernel</code> æ”¯æŒï¼Œç¬”è€…çš„å®éªŒç¯å¢ƒæ»¡è¶³ macvlan çš„è¦æ±‚ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç¡®å®šï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo lsmod | grep macvlan</span><br><span class="line"><span class="comment"># è‹¥æ— ä»»ä½•è¿”å›ï¼Œè¯´æ˜è¿˜æœªåŠ è½½ macvlan å†…æ ¸æ¨¡å—ã€‚</span></span><br><span class="line">$ sudo modprobe macvlan</span><br><span class="line"><span class="comment"># åŠ è½½ macvlan å†…æ ¸æ¨¡å—ï¼Œè‹¥æ‰§è¡ŒæŠ¥é”™ï¼Œè¯´æ˜ kernel ä¸æ”¯æŒè¯¥ç‰¹æ€§ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>podman ä¸ macvlan ç±»å‹ç½‘ç»œçš„é›†æˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo podman network create -d macvlan -o parent=ens33 &lt;network_name&gt;</span><br><span class="line">  /etc/cni/net.d/&lt;network_name&gt;.conflist</span><br><span class="line"><span class="comment"># åˆ›å»º macvlan ç±»å‹ç½‘ç»œ  </span></span><br><span class="line">$ sudo podman network ls</span><br><span class="line">$ sudo /opt/cni/bin/dhcp daemon</span><br><span class="line"><span class="comment"># åœ¨å¦ä¸€ä¸ªçª—å£ä¸­å¯åŠ¨ dhcp å®ˆæŠ¤è¿›ç¨‹ä¾› macvlan æ’ä»¶è°ƒç”¨ï¼Œä¸ºå®¹å™¨ç½‘å£åˆ†é… IP åœ°å€ã€‚</span></span><br><span class="line">$ sudo podman run -it --rm \</span><br><span class="line">  --name &lt;container_name&gt; --network=&lt;network_name&gt; \</span><br><span class="line">  &lt;container_image&gt;:&lt;tag&gt; /bin/sh</span><br><span class="line"><span class="comment"># åˆ›å»ºæ”¯æŒ macvlan ç±»å‹ç½‘ç»œçš„ rootfull å®¹å™¨</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»ä¸ rootfull å®¹å™¨åœ¨åŒä¸€å¹¿æ’­åŸŸçš„å…¶ä»–èŠ‚ç‚¹ä¸Š ping è¯¥å®¹å™¨ï¼Œå¯æ­£å¸¸é€šä¿¡ï¼š<br><img src="podman-macvlan-network.png" alt="podman-macvlan-network.png"></p>
<blockquote>
<p>ğŸ¤” ä»¥ä¸Šç¤ºä¾‹çš„å®¹å™¨ä¸­è¿è¡Œ Web æœåŠ¡ï¼ˆå¯æš´éœ² 443 ç«¯å£ï¼‰ï¼Œä½¿ç”¨ macvlan ç½‘ç»œæ¨¡å¼å¯æ‰“é€šä¸åŒä¸€å¹¿æ’­åŸŸä¸­å¤–éƒ¨èŠ‚ç‚¹çš„é€šä¿¡ï¼Œä½†æ— æ³•è®¿é—®å…¶ä¸­çš„æœåŠ¡ï¼Œå¯é‡‡å–ä½•ç§æ–¹æ³•è§£å†³è¯¥é—®é¢˜ï¼Ÿ  </p>
</blockquote>
</li>
</ul>
<h3 id="Podman-rootless-å®¹å™¨ç”¨æˆ·æ˜ å°„å®ç°æ–¹å¼ï¼š"><a href="#Podman-rootless-å®¹å™¨ç”¨æˆ·æ˜ å°„å®ç°æ–¹å¼ï¼š" class="headerlink" title="Podman rootless å®¹å™¨ç”¨æˆ·æ˜ å°„å®ç°æ–¹å¼ï¼š"></a>Podman rootless å®¹å™¨ç”¨æˆ·æ˜ å°„å®ç°æ–¹å¼ï¼š</h3><ul>
<li>Podman rootless å®¹å™¨çš„å®ç°æ ¸å¿ƒåœ¨äºè§£å†³ network namespaceï¼ˆNetNSï¼‰ ä¸ user namespaceï¼ˆUserNSï¼‰ çš„é—®é¢˜ï¼Œå‰æ–‡å·²ä»‹ç» NetNS çš„å®ç°æ–¹å¼ï¼Œåæ–‡å°†ä»‹ç» UserNS çš„å®ç°æ–¹å¼ã€‚</li>
<li><p>è‹¥è¦ä½¿ç”¨ rootless å®¹å™¨ï¼Œéœ€ç¡®è®¤ OS æ˜¯å¦å¼€å¯ user namespace åŠŸèƒ½ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sysctl -a | grep user\.max_user_namespaces</span><br><span class="line">  user.max_user_namespaces = 47494</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç³»ç»Ÿä¸Šæ¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·å°±ä¼šåœ¨ <code>/etc/subuid</code> ä¸ <code>/etc/subgid</code> ä¸­ç”Ÿæˆå¯¹åº”ç”¨æˆ·åœ¨å…¶ç”¨æˆ·å‘½åç©ºé—´ä¸­çš„æ˜ å°„è§„åˆ™ï¼Œä»¥ /etc/subuid ä¸ºä¾‹ï¼Œå‚æ•°ä»¥å†’å·åˆ†éš”ï¼Œæ¯ä¸ªå‚æ•°å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š  </p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆuidï¼‰ï¼šç”¨æˆ·åç§°  </li>
<li>ç¬¬äºŒä¸ªå‚æ•°ï¼ˆloweruidï¼‰ï¼šç”¨æˆ·å‘½åç©ºé—´ä¸­èµ·å§‹çš„æ˜ å°„ uid</li>
</ul>
</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆcountï¼‰ï¼šç”¨æˆ·å‘½åç©ºé—´å†…éƒ¨ä¸å¤–éƒ¨å¯æ˜ å°„ uid æ•°é‡ï¼ˆå¯ç†è§£ä¸ºæ‰€æœ‰å®¹å™¨æ™®é€šç”¨æˆ·çš„ uid æ•°é‡å’Œï¼‰<br><img src="rootless-user-namespace-mapping.jpg" alt="rootless-user-namespace-mapping.jpg"></li>
<li>ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶å…è®¸è¿è¡Œè¿›ç¨‹çš„ uid æ˜ å°„èŒƒå›´ï¼Œåœ¨ <code>/proc/&lt;pid&gt;/uid_map</code> ä¸­å®šä¹‰ã€‚</li>
<li>å¯è¿‡æ»¤å®¹å™¨ <code>conmon</code> è¿›ç¨‹çš„ pid ç¡®è®¤æ¯ä¸ªå®¹å™¨ä¸­çš„ uid æ˜ å°„æƒ…å†µï¼Œå‚è§ä»¥ä¸‹ç¤ºä¾‹ã€‚</li>
<li>å…³äºä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶çš„å…·ä½“è¯´æ˜å¯å‚è€ƒ <code>newuidmap</code> ä¸ <code>newgidmap</code> å‘½ä»¤çš„ man æ‰‹å†Œã€‚</li>
<li><p>å¯å‚è€ƒ Podman å®˜æ–¹æ¨èçš„å‘½ä»¤åˆ›å»º uid çš„æ˜ å°„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo usermod --add-subuids 10000-75535 $(whoami)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----- ç¤ºä¾‹ -----</span></span><br><span class="line">$ sudo cat /etc/subuid</span><br><span class="line">  appuser:10000:500</span><br><span class="line">$ sudo cat /etc/subgid</span><br><span class="line">  appuser:500:50</span><br><span class="line"><span class="comment"># è¯¥ç”¨æˆ·åˆ›å»ºçš„ user namespace ä¸­å¯ä»¥ä½¿ç”¨ä» 10000 å¼€å§‹çš„ 500 ä¸ª UID å’Œä» 500 å¼€å§‹çš„ 50 ä¸ª GID çš„æ˜ å°„ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ğŸš€ ç¤ºä¾‹ï¼š<br>æ™®é€šç”¨æˆ· hualf åœ¨ /etc/subuid ä¸­æ˜ å°„ä¸º hualf:165536:65536ï¼Œè¯´æ˜åœ¨è¯¥ç”¨æˆ·çš„ç”¨æˆ·å‘½åç©ºé—´ä¸­å¯åµŒå¥—ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·å‘½åç©ºé—´ï¼ˆæˆ–å®¹å™¨ï¼‰ï¼Œæ¯ä¸ªå®¹å™¨ä¸­çš„ root ç”¨æˆ· uid 0 éƒ½æ˜ å°„ä¸º hualf ç”¨æˆ·çš„ uid 1001ï¼ˆè¿è¡Œå®¹å™¨è¿›ç¨‹çš„ç”¨æˆ·ï¼‰ï¼Œè€Œå®¹å™¨ä¸­æ™®é€šç”¨æˆ·çš„ uid æ˜ å°„è‡³å®¿ä¸»æœºçš„ subuid èŒƒå›´ä¸­ï¼Œå¯¹äºæ­¤ä¾‹ subuid èŒƒå›´ä¸º 165536~231071ï¼Œå®¹å™¨ä¸­çš„ uid 1 ç”¨æˆ·æ˜ å°„ä¸ºå®¿ä¸»æœº uid 165536ï¼Œå› æ­¤å®¹å™¨ä¸­ admin ç”¨æˆ· uid 1000 æ˜ å°„ä¸ºå®¿ä¸»æœº uid 166535ï¼ˆ165536+999ï¼‰ã€‚<br>é€šè¿‡å®¹å™¨å®¿ä¸»æœºä¸Šæ¯ä¸ªæ™®é€šç”¨æˆ·çš„ç”¨æˆ·å‘½åç©ºé—´çš„ subuid æ˜ å°„èŒƒå›´ï¼Œå¯åˆ†é…ä¼—å¤š uid åœ¨ rootless å®¹å™¨ä¸­è¿è¡Œåº”ç”¨è¿›ç¨‹ã€‚<br><img src="user-namespace-subuid-mapping-1-edited.png" alt="user-namespace-subuid-mapping-1-edited.png"><img src="user-namespace-subuid-mapping-2-edited.png" alt="user-namespace-subuid-mapping-2-edited.png"></p>
</li>
</ul>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><ul>
<li><a href="https://projectatomic.io/blog/2018/02/reintroduction-podman/" target="_blank" rel="noopener">Reintroduction of Podman</a></li>
<li><a href="https://fedoramagazine.org/podman-pods-fedora-containers/" target="_blank" rel="noopener">Using pods with Podman on Fedora</a></li>
<li><a href="https://www.redhat.com/sysadmin/container-networking-podman" target="_blank" rel="noopener">Configuring container networking with Podman</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/building_running_and_managing_containers/index" target="_blank" rel="noopener">RedHat docs - Building, running, and managing Linux containers on Red Hat Enterprise Linux 8</a></li>
<li><a href="https://developer.aliyun.com/article/700923" target="_blank" rel="noopener">å®¹å™¨å®‰å…¨æ‹¾é— - Rootless Containeråˆæ¢</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/admin-guide/sysctl/user.html" target="_blank" rel="noopener">Documentation for /proc/sys/user/</a></li>
<li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">docker docs - Overview of Docker Compose</a></li>
<li><a href="https://www.cni.dev/plugins/current/meta/firewall/" target="_blank" rel="noopener">CNI docs - firewall plugin</a></li>
<li><a href="https://www.cni.dev/plugins/current/meta/firewall/" target="_blank" rel="noopener">CNI docs - Port-mapping plugin</a></li>
<li><a href="https://fossies.org/linux/podman/docs/tutorials/basic_networking.md" target="_blank" rel="noopener">https://fossies.org/linux/podman/docs/tutorials/basic_networking.md</a></li>
</ul>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2022/12/05/podman-usage-practice/" data-toggle="tooltip" data-placement="top" title="Podman å®¹å™¨åŸç†ä¸ä½¿ç”¨ï¼ˆ2ï¼‰">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2022/11/28/fcos-rhcos-basic-usage/" data-toggle="tooltip" data-placement="top" title="ğŸ“¦ Fedora CoreOS åŠ RHCOS æ¦‚è¿°ä¸åº”ç”¨">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#äº‘åŸç”Ÿ" title="äº‘åŸç”Ÿ">äº‘åŸç”Ÿ</a>
                        
                          <a class="tag" href="/tags/#å®¹å™¨" title="å®¹å™¨">å®¹å™¨</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://github.com/Alberthua-Perl" target="_blank">Alberthua</a></li>
                    
                        <li><a href="https://github.com/xwanli0923" target="_blank">xwanli0923</a></li>
                    
                        <li><a href="https://github.com/rowheel" target="_blank">rowheel</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>









    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/Alberthua-Perl">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Alberthua Blog 2022 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://alberthua-perl.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="https://alberthua-perl.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
